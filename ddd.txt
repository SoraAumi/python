Index: src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/server_layout_doc_cdd_item.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/server_layout_doc_cdd_item.lwm b/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/server_layout_doc_cdd_item.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/server_layout_doc_cdd_item.lwm	(revision f464a3be3eb462d48df8e44e3866e3c4c3340c49)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/server_layout_doc_cdd_item.lwm	(revision fce87bbd0e7c858c0859330362dcba736c5a0ffb)
@@ -9,13 +9,14 @@
     <bm:operations>
         <bm:operation name="query">
             <bm:query-sql><![CDATA[
+            select t2.* from (
             select
             rownum as order_num,
             t1.*
              from(
                 SELECT
                     pp.creation_date,
-                    to_char(pci.creation_date,'yyyy-mm-dd hh24:mi:ss') creatiodate,
+                    to_char(pci.creation_date,'yyyy-mm-dd') creatiodate,
                     -- 文档分类 add by wujun for huaneng 2018-6-12
                     pci.cdd_class,
                     pci.cdd_class_code,
@@ -64,7 +65,7 @@
               --add by zc 资料清单优化
               pp.important_concerns,
               pp.investigate_guide_flag,
-              (select v.code_value_name from sys_code_values_v v where v.code = 'YES_NO' and v.code_value=pp.investigate_guide_flag) investigate_guide_flag_n,
+              (select v.code_value_name from sys_code_values_v v where v.code = 'PRJ_PLAN_ATTACHMENT_INVESTIGATE_GUIDE_FLAG' and v.code_value=pp.investigate_guide_flag) investigate_guide_flag_n,
               pp.reason_alternative,
               --end
                     (select ct.content_print_flag from con_contract_content ct where ct.check_id = pp.check_id) content_print_flag,
@@ -89,6 +90,7 @@
                     )file_count,
                     pci.sys_flag,
                     pci.note,
+                    pci.feedback,
                     pci.cdd_list_id,
                     pci.cdd_item_id,
                     pci.line_type,
@@ -107,6 +109,8 @@
                     pci.chance_tab_group,
                     pci.project_tab_group,
                     pci.contract_tab_group,
+                    pci.bind_bp_id,
+                    (select bp_name from hls_bp_master where bp_id = pci.bind_bp_id) bp_name,
                     pci.false_required_flag,/* add zxt 非必传标志*/
                     pci.sign_tab_group,
                     pci.incept_tab_group,
@@ -192,8 +196,8 @@
               pck.mark_flag,
               pck.confirm_flag,
               pck.important_concerns,
-              pck.investigate_guide_flag,
-              (select  v.code_value_name from sys_code_values_v v where v.code = 'YES_NO_ALL' and v.code_value=pck.investigate_guide_flag) investigate_guide_flag_n,
+              nvl(pck.investigate_guide_flag, 'Y') as investigate_guide_flag,
+              (select  v.code_value_name from sys_code_values_v v where v.code = 'PRJ_PLAN_ATTACHMENT_INVESTIGATE_GUIDE_FLAG' and v.code_value= nvl(pck.investigate_guide_flag, 'Y')) investigate_guide_flag_n,
               pck.reason_alternative
                     FROM
                         prj_cdd_item_doc_ref pcf,
@@ -223,8 +227,8 @@
                     pci.cdd_list_id  = nvl(${/parameter/@cdd_list_id},${@cdd_list_id}) AND
                     pci.enabled_flag ='Y'
                     and lgt.cdd_list_id = pci.cdd_list_id
-                    order by decode(pp.confirm_flag,'Y',1,'N',3,2),pci.cdd_class
-                    )t1 #WHERE_CLAUSE#
+                    order by  decode(pci.cdd_class, '承租人资料', 2, '保证人资料', 3, '申请人基本资料', 2, '担保人基本资料', 3, 1), pci.bind_bp_id, lgt.seq_num, pci.order_seq
+                    )t1 #WHERE_CLAUSE#) t2 order by decode(t2.confirm_flag,'Y',1,'N',3,'',3, 2), decode(t2.cdd_class, '承租人资料', 2, '保证人资料', 3, '申请人基本资料', 2, '担保人基本资料', 3, 1), t2.bind_bp_id, t2.seq_num, t2.order_seq, t2.order_num

             ]]></bm:query-sql>
         </bm:operation>
@@ -264,6 +268,7 @@
 							          p_lender_tab_group=>${@lender_tab_group},
                                       p_sys_flag              =>${@sys_flag},
                                       p_note                  =>${@note},
+                                      p_feedback              =>${@feedback},
                                       p_send_flag             =>${@send_flag},
                                       p_paper_required        =>${@paper_required},
                                       p_attachment_required   =>${@attachment_required},
@@ -278,6 +283,7 @@
                                       p_sign_num =>${@sign_num}
                                       );

+
                                update  prj_cdd_item_check pci
 									  set pci.note1 = ${@note1},
 									      pci.audit_status = ${@audit_status},
@@ -473,6 +479,9 @@
         <bm:field name="receive_flag"/>
         <bm:field name="mark_flag"/>
         <bm:field name="confirm_flag"/>
+        <bm:field name="feedback"/>
+        <bm:field name="bind_bp_id"/>
+        <bm:field name="bp_name"/>

         <bm:field name="seq_num"/>
         <bm:field name="important_concerns"/>
@@ -491,6 +500,7 @@
         <!--用于项目变更仅查询本次新增的变更附件资料-->
         <bm:query-field name="prj_change_query_flag" queryExpression="(${@prj_change_query_flag} is not null and t1.version_display is null)"/>
         <bm:query-field name="attachment_tab_group" queryExpression="t1.attachment_tab_group like '%'||${@attachment_tab_group}||'%' "/>
+        <bm:query-field name="confirm_flag" queryExpression="t1.confirm_flag = ${@confirm_flag}"/>

     </bm:query-fields>
 </bm:model>
Index: src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_file_archive_info_wfl.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_file_archive_info_wfl.lview b/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_file_archive_info_wfl.lview
--- a/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_file_archive_info_wfl.lview	(revision f464a3be3eb462d48df8e44e3866e3c4c3340c49)
+++ b/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_file_archive_info_wfl.lview	(revision fce87bbd0e7c858c0859330362dcba736c5a0ffb)
@@ -5,7 +5,8 @@
     $Revision: 1.0
     $Purpose: 档案归档附件
 -->
-<a:screen xmlns:c="leaf.application.action" xmlns:a="http://www.leaf-framework.org/application" xmlns:p="uncertain.proc" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
+<a:screen xmlns:a="http://www.leaf-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true"
+          trace="true">
     <a:init-procedure>
         <a:model-query defaultWhereClause="t1.archive_batch_id=${/parameter/@archive_batch_id}" model="acrch.ARCHIVE002.arch002_project_info" rootPath="project_path"/>
     </a:init-procedure>
@@ -264,17 +265,39 @@
             if (!records.length) {
                 return;
             }
-            if(current_seq === '10'){
+
+            //合规性文件 文件类型默认要件类
+            if(ds.id === 'pro_report_cdd_result_ds'){
+                ds.getAll().forEach(record =>{
+                    if(!record.get("cdd_category")){
+                        record.set("cdd_category", "要件类")
+                    }
+                })
+            }
+
+            if("${/session/@user_id}" === "1"){
                 for (var j = 0;j < records.length;j++) {
+                    records[j].getField('important_concerns').setReadOnly(true);
+                    records[j].getField('note').setReadOnly(true);
+                    records[j].getField('feedback').setReadOnly(true);
                     records[j].getField('arch_par_has_flag').setReadOnly(true);
                     records[j].getField('arch_par_has_flag_desc').setReadOnly(true);
-                    records[j].getField('sign_num').setReadOnly(true);
+
+                }
+            }
+
+            if(current_seq === '10'){
+                for (var j = 0;j < records.length;j++) {
+                    records[j].getField('arch_par_has_flag').setReadOnly(false);
+                    records[j].getField('arch_par_has_flag_desc').setReadOnly(false);
+                    //records[j].getField('sign_num').setReadOnly(true);
+
                 }
             }
             else if(current_seq === '20'){
                 for (var j = 0;j < records.length;j++) {
                     records[j].getField('note').setReadOnly(true);
-                    records[j].getField('important_concerns').setReadOnly(true);
+                    //records[j].getField('important_concerns').setReadOnly(true);
                 }
             }
         }
@@ -358,16 +381,46 @@

         function prj_plan_confirm(status,ds_id){
             var records=$(ds_id).getSelected();
+            let para_str = $(ds_id).queryurl.split("?")[1].split("&")
+            let attachment_tab_group, cdd_list_id
+            para_str.forEach(para =>{
+                let para_name = para.split("=")[0]
+                let para_value = para.split("=")[1]
+                if(para_name === 'attachment_tab_group'){
+                    attachment_tab_group = para_value
+                } else if(para_name === 'cdd_list_id'){
+                    cdd_list_id = para_value
+                }
+            })
+
+
             if (records.length==0){
                 Leaf.showMessage('${l:PROMPT}', '请至少勾选一项！');
                 return;
             }
+
+            //先标记再反选
             for (var i = 0; i < records.length; i++) {
                 Leaf.request({
                     url: '${/request/@context_path}/autocrud/acrch.ARCHIVE002.arch002_project_info/update',
                     para: {
                         check_id: records[i].get('check_id'),
-                        status:status
+                        status
+                    },
+                    success:function(){
+                        $(ds_id).query();
+                    },
+                    scope: this
+                });
+            }
+
+            if(status === 'M'){
+                //反选操作
+                Leaf.request({
+                    url: '${/request/@context_path}/autocrud/acrch.ARCHIVE002.arch002_project_info/execute',
+                    para: {
+                        attachment_tab_group,
+                        cdd_list_id
                     },
                     success: function (args) {
                         Leaf.SideBar.show({
@@ -381,28 +434,29 @@
             }
         }

+
         function prj_plan_confirm1(){
-            prj_plan_confirm("Y","archive_prj_bp_cdd_result_ds");
+            prj_plan_confirm("M","archive_prj_bp_cdd_result_ds");
         }

         function prj_plan_cancel1(){
-            prj_plan_confirm("N","archive_prj_bp_cdd_result_ds");
+            prj_plan_confirm("Y","archive_prj_bp_cdd_result_ds");
         }

         function prj_plan_confirm2(){
+            prj_plan_confirm("M","pro_report_cdd_result_ds");
+        }
+
+        function prj_plan_cancel2(){
             prj_plan_confirm("Y","pro_report_cdd_result_ds");
         }

-        function prj_plan_cancel2(){
-            prj_plan_confirm("N","pro_report_cdd_result_ds");
-        }
-
         function prj_plan_confirm3(){
-            prj_plan_confirm("Y","prj_report_cdd_result_ds");
+            prj_plan_confirm("M","prj_report_cdd_result_ds");
         }

         function prj_plan_cancel3(){
-            prj_plan_confirm("N","prj_report_cdd_result_ds");
+            prj_plan_confirm("Y","prj_report_cdd_result_ds");
         }

         //        function prj_plan_confirm4(){
@@ -415,44 +469,80 @@


         function prj_plan_confirm5(){
+            prj_plan_confirm("M","archive_sign_cdd_result_ds");
+        }
+
+        function prj_plan_cancel5(){
             prj_plan_confirm("Y","archive_sign_cdd_result_ds");
         }

-        function prj_plan_cancel5(){
-            prj_plan_confirm("N","archive_sign_cdd_result_ds");
-        }
-
         function prj_plan_confirm6(){
-            prj_plan_confirm("Y","archive_change_bp_cdd_result_ds");
+            prj_plan_confirm("M","archive_change_bp_cdd_result_ds");
         }

         function prj_plan_cancel6(){
-            prj_plan_confirm("N","archive_change_bp_cdd_result_ds");
+            prj_plan_confirm("Y","archive_change_bp_cdd_result_ds");
         }

         function prj_plan_confirm7(){
-            prj_plan_confirm("Y","pro_report_cdd_result_ds");
+            prj_plan_confirm("M","pro_report_cdd_result_ds");
         }

         function prj_plan_cancel7(){
-            prj_plan_confirm("N","pro_report_cdd_result_ds");
+            prj_plan_confirm("Y","pro_report_cdd_result_ds");
         }

         function prj_plan_confirm8(){
-            prj_plan_confirm("Y","prj_report_cdd_result_ds");
+            prj_plan_confirm("M","prj_report_cdd_result_ds");
         }

         function prj_plan_cancel8(){
-            prj_plan_confirm("N","prj_report_cdd_result_ds");
+            prj_plan_confirm("Y","prj_report_cdd_result_ds");
         }

         function prj_plan_confirm9(){
+            prj_plan_confirm("M","prj_report_cdd_result_ds");
+        }
+
+        function prj_plan_cancel9(){
             prj_plan_confirm("Y","prj_report_cdd_result_ds");
         }

-        function prj_plan_cancel9(){
-            prj_plan_confirm("N","prj_report_cdd_result_ds");
+        /**
+         * 为项目报告ds添加动态查询参数
+         */
+        function prj_report_query(ds, qpara){
+            if('${/parameter/@submit_from}' === 'PRJ_PLAN_REPORT' && '${/parameter/@document_type}' === 'PRJF') {
+                qpara['attachment_tab_group'] = 'PRJ_CHANGE'
+            }
+            else{
+                qpara['attachment_tab_group'] = 'PRJ_CHANGE'
+            }
+        }
+
+        function archive_detail_query(ds, qpara){
+
+                qpara['attachment_tab_group'] = ''
         }
+
+        // 合规性材料All
+        function pro_report_query(ds, qpara){
+            if(('${/parameter/@submit_from}' === 'PRJ_PLAN' || '${/parameter/@submit_from}' === 'PRJ_PLAN_CHANGE') && '${/parameter/@document_type}' === 'PRJF') {
+                if('${/parameter/@receive_type}' === 'NOW'){
+                    qpara['attachment_tab_group'] = 'COMPLIANCE_PRJF_NOW'
+                } else{
+                    qpara['attachment_tab_group'] = 'COMPLIANCE_PRJF_FUTURE'
+                }
+            }
+
+            else{
+                qpara['attachment_tab_group'] = 'PROJECT'
+            }
+            console.log(qpara['attachment_tab_group'])
+        }
+
+
+

         ]]></script>
         <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.lview"/>
@@ -483,6 +573,7 @@
                 </a:fields>
                 <a:events>
                     <a:event name="load" handler="archive_detail_ds_load"/>
+                    <a:event name="query" handler="archive_detail_query"/>
                 </a:events>
             </a:dataSet>

@@ -505,6 +596,7 @@
                 </a:fields>
                 <a:events>
                     <a:event name="load" handler="archive_detail_ds_load"/>
+                    <a:event name="query" handler="archive_detail_query"/>
                 </a:events>
             </a:dataSet>

@@ -552,7 +644,7 @@

             <a:dataSet id="pro_report_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=PROJECT&amp;arch_not_required_flag=N"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -568,12 +660,13 @@
                 </a:fields>
                 <a:events>
                     <a:event name="load" handler="archive_detail_ds_load"/>
+                    <a:event name="query" handler="pro_report_query"/>
                 </a:events>
             </a:dataSet>

             <a:dataSet id="prj_report_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=PRJ_CHANGE&amp;arch_not_required_flag=N"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -589,93 +682,108 @@
                 </a:fields>
                 <a:events>
                     <a:event name="load" handler="archive_detail_ds_load"/>
+                    <a:event name="query" handler="prj_report_query"/>
                 </a:events>
             </a:dataSet>
         </a:dataSets>

         <a:screenBody>
-            <a:switch test="/parameter/@submit_from">
-                <a:case value="PRJ_PLAN">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
-                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+            <a:switch test="/parameter/@archive_flag">
+                <a:case value="N">
+
+                </a:case>
+                <a:case value="*">
+                    <a:switch test="/parameter/@submit_from">
+                        <a:case value="PRJ_PLAN">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                                    <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds"  prompt="归档责任人" readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="PRJ_PLAN_REPORT">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
-                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+                        <a:case value="PRJ_PLAN_REPORT">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                                    <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人"  readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="PRJ_PLAN_CHANGE">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
-                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+                        <a:case value="PRJ_PLAN_CHANGE">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                                    <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="PRJ_PLAN_REPORT_CHANGE_A">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
-                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+                        <a:case value="PRJ_PLAN_REPORT_CHANGE_A">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                                    <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="PRJ_PLAN_REPORT_CHANGE_B">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
-                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+                        <a:case value="PRJ_PLAN_REPORT_CHANGE_B">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                                    <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="SIGN">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="contract_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
-                            <a:textField name="virtual_con_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                        <a:hBox labelWidth="120">
-                            <a href="javascript:winOpen_contractDetailInfo();" style="margin-left:120px;text-decoration:underline">合同明细</a>
-                        </a:hBox>
-                    </a:form>
-                </a:case>
+                        <a:case value="SIGN">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="contract_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
+                                    <a:textField name="virtual_con_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>4
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                                <a:hBox labelWidth="120">
+                                    <a href="javascript:winOpen_contractDetailInfo();" style="margin-left:120px;text-decoration:underline">合同明细</a>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>

-                <a:case value="*">
-                    <a:form marginWidth="25" title="基本信息">
-                        <a:hBox labelWidth="100">
-                            <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="project_number" bindTarget="arch002_project_info_ds" prompt="项目编号" readOnly="true"/>
-                            <a:textField name="project_name" bindTarget="arch002_project_info_ds" prompt="项目名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
-                        </a:hBox>
-                        <a:hBox labelWidth="120">
-                            <a href="javascript:winOpen_projectDetailInfo();" style="margin-left:120px;text-decoration:underline">项目明细</a>
-                        </a:hBox>
-                    </a:form>
+                        <a:case value="*">
+                            <a:form marginWidth="25" title="基本信息">
+                                <a:hBox labelWidth="100">
+                                    <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
+                                    <a:textField name="project_number" bindTarget="arch002_project_info_ds" prompt="项目编号" readOnly="true"/>
+                                    <a:textField name="project_name" bindTarget="arch002_project_info_ds" prompt="项目名称" readOnly="true" width="250"/>
+                                    <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                                    <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
+                                </a:hBox>
+                                <a:hBox labelWidth="120">
+                                    <a href="javascript:winOpen_projectDetailInfo();" style="margin-left:120px;text-decoration:underline">项目明细</a>
+                                </a:hBox>
+                            </a:form>
+                        </a:case>
+                    </a:switch>
                 </a:case>
             </a:switch>

@@ -697,28 +805,31 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid1_id" bindTarget="archive_prj_bp_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id1" click="prj_plan_confirm1" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id1" click="prj_plan_cancel1" text="取消不归档"/>
                                                             <a:button id = "save_btn1" type="save"/>
-                                                            <a:button id = "plan_id1" click="prj_plan_confirm1" text="确认"/>
-                                                            <a:button id = "plan_cancel_id1" click="prj_plan_cancel1" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
                                                             <a:column name="order_num"  prompt="序号" width="30"/>
                                                             <a:column name="show_seq"  prompt="重要文件" width="100"/>
                                                             <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                            <a:column name="bp_name"  prompt="商业伙伴名称" width="180"/>
                                                             <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                             <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
                                                             <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
                                                             <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
                                                             <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
                                                             <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
-                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid1_nf" width="100"/>
+                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid1_tf" width="100"/>
                                                             <a:column name="sign_num"  prompt="份数" editor="archive_grid1_nf" width="100"/>
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid1_cb" width="100"/>
+                                                            <a:column name="investigate_guide_flag_n"  prompt="是否符合审查指引"  width="100"/>
+                                                            <a:column name="reason_alternative"  prompt="不符合原因或替代文件"  width="200"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid1_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid1_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid1_cb"/>
@@ -741,9 +852,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid2_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id2" click="prj_plan_confirm2" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id2" click="prj_plan_cancel2" text="取消不归档"/>
                                                             <a:button id = "save_btn2" type="save"/>
-                                                            <a:button id = "plan_id2" click="prj_plan_confirm2" text="确认"/>
-                                                            <a:button id = "plan_cancel_id2" click="prj_plan_cancel2" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -756,13 +867,15 @@
                                                             <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
                                                             <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
                                                             <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
-                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid0_nf" width="100"/>
+                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid0_tf" width="100"/>
                                                             <a:column name="sign_num"  prompt="份数" editor="archive_grid0_nf" width="100"/>
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid0_cb" width="100"/>
+                                                            <a:column name="investigate_guide_flag_n"  prompt="是否符合审查指引"  width="100"/>
+                                                            <a:column name="reason_alternative"  prompt="不符合原因或替代文件"  width="200"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid0_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid0_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid0_cb"/>
@@ -788,9 +901,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid3_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id3" click="prj_plan_confirm3" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id3" click="prj_plan_cancel3" text="取消不归档"/>
                                                             <a:button id = "save_btn3" type="save"/>
-                                                            <a:button id = "plan_id3" click="prj_plan_confirm3" text="确认"/>
-                                                            <a:button id = "plan_cancel_id3" click="prj_plan_cancel3" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -803,13 +916,13 @@
                                                             <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
                                                             <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
                                                             <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
-                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid12_nf" width="100"/>
+                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid12_tf" width="100"/>
                                                             <a:column name="sign_num"  prompt="份数" editor="archive_grid12_nf" width="100"/>
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid12_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid12_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid12_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid12_cb"/>
@@ -835,9 +948,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid4_id" bindTarget="archive_payment_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id4" click="prj_plan_confirm4" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id4" click="prj_plan_cancel4" text="取消不归档"/>
                                                             <a:button id="save_btn4" type="save"/>
-                                                            <a:button id = "plan_id4" click="prj_plan_confirm4" text="确认"/>
-                                                            <a:button id = "plan_cancel_id4" click="prj_plan_cancel4" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -850,13 +963,13 @@
                                                             <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
                                                             <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
                                                             <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
-                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid8_nf" width="100"/>
+                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid8_tf" width="100"/>
                                                             <a:column name="sign_num"  prompt="份数" editor="archive_grid8_nf" width="100"/>
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid8_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
                                                             <a:column name="creation_date_s" prompt="归档日期" width="110"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid8_tf"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid8_tf"/>

                                                         </a:columns>
                                                         <a:editors>
@@ -883,9 +996,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid5_id" bindTarget="archive_sign_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id5" click="prj_plan_confirm5" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id5" click="prj_plan_cancel5" text="取消不归档"/>
                                                             <a:button id="save_btn5" type="save"/>
-                                                            <a:button id = "plan_id5" click="prj_plan_confirm5" text="确认"/>
-                                                            <a:button id = "plan_cancel_id5" click="prj_plan_cancel5" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -898,13 +1011,13 @@
                                                             <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
                                                             <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
                                                             <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
-                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid9_nf" width="100"/>
+                                                            <a:column name="important_concerns"  prompt="文号" editor="archive_grid9_tf" width="100"/>
                                                             <a:column name="sign_num"  prompt="份数" editor="archive_grid9_nf" width="100"/>
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid9_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid9_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid9_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid9_cb"/>
@@ -930,9 +1043,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid6_id" bindTarget="archive_change_bp_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id6" click="prj_plan_confirm6" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id6" click="prj_plan_cancel6" text="取消不归档"/>
                                                             <a:button id = "save_btn6" type="save"/>
-                                                            <a:button id = "plan_id6" click="prj_plan_confirm6" text="确认"/>
-                                                            <a:button id = "plan_cancel_id6" click="prj_plan_cancel6" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -950,8 +1063,8 @@
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid1_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid1_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid1_tf"/>

                                                         </a:columns>
                                                         <a:editors>
@@ -965,15 +1078,15 @@
                                         </a:tabPanel>
                                     </a:tab>

-                                    <a:tab prompt="合规性资料" id="change_report_info_id" width="130">
+                                    <a:tab prompt="合规性材料" id="change_report_info_id" width="130">
                                         <a:tabPanel height="400" marginWidth="50">
                                             <a:tabs>
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid7_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id7" click="prj_plan_confirm7" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id7" click="prj_plan_cancel7" text="取消不归档"/>
                                                             <a:button id = "save_btn7" type="save"/>
-                                                            <a:button id = "plan_id7" click="prj_plan_confirm7" text="确认"/>
-                                                            <a:button id = "plan_cancel_id7" click="prj_plan_cancel7" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -991,8 +1104,8 @@
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid12_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid12_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid12_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid12_cb"/>
@@ -1019,9 +1132,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid8_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id8" click="prj_plan_confirm8" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id8" click="prj_plan_cancel8" text="取消不归档"/>
                                                             <a:button id = "save_btn8" type="save"/>
-                                                            <a:button id = "plan_id8" click="prj_plan_confirm8" text="确认"/>
-                                                            <a:button id = "plan_cancel_id8" click="prj_plan_cancel8" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -1039,8 +1152,8 @@
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid14_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid14_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid14_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid14_cb"/>
@@ -1065,9 +1178,9 @@
                                                 <a:tab prompt="归档材料清单" width="140">
                                                     <a:grid id = "archive_file_grid9_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                         <a:toolBar>
+                                                            <a:button id = "plan_id9" click="prj_plan_confirm9" text="确认不归档"/>
+                                                            <a:button id = "plan_cancel_id9" click="prj_plan_cancel9" text="取消不归档"/>
                                                             <a:button id = "save_btn9" type="save"/>
-                                                            <a:button id = "plan_id9" click="prj_plan_confirm9" text="确认"/>
-                                                            <a:button id = "plan_cancel_id9" click="prj_plan_cancel9" text="取消"/>
                                                         </a:toolBar>
                                                         <a:columns>
                                                             <a:column name="cdd_category" prompt="文件类型" width="80" />
@@ -1085,8 +1198,8 @@
                                                             <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid14_cb" width="100"/>
                                                             <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
                                                             <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
-                                                            <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                            <a:column name="note" prompt="说明" width="300" editor="archive_grid14_tf"/>
+                                                            <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                            <a:column name="note" prompt="说明" width="200" editor="archive_grid14_tf"/>
                                                         </a:columns>
                                                         <a:editors>
                                                             <a:comboBox id="archive_grid14_cb"/>
@@ -1112,6 +1225,8 @@
             } else {
                 document.getElementById("hn_atm_complement_atm_tab").style.display = "none";
             }*/
+
+
             if ('${/parameter/@show_button}' == 'N' && '${/parameter/@archive_flag}'!='N') {
                 if('${/parameter/@submit_from}'=='PRJ_PLAN'){
                     $('plan_id1').hide();
@@ -1176,6 +1291,7 @@
                     $('plan_cancel_id9').hide();
                 }
             }
+            console.log('${/parameter/@document_type}' + ' ' + '${/parameter/@submit_from}', ' ' + '${/parameter/@archive_batch_id}')
         });
         ]]></script>
     </a:view>
Index: src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/arch002_project_info.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/arch002_project_info.lwm b/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/arch002_project_info.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/arch002_project_info.lwm	(revision 832c448dc170152bf368609ba2827657fb786176)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/acrch/ARCHIVE002/arch002_project_info.lwm	(revision fce87bbd0e7c858c0859330362dcba736c5a0ffb)
@@ -62,9 +62,14 @@
                        where bp.bp_id = p.bp_id_tenant) bp_id_tenant_n,
                      p.bp_id_tenant bp_id,
                      p.lease_organization,
-                     (select lo.description
-                        from hls_lease_organization lo
-                       where lo.lease_organization = p.lease_organization) lease_organization_n,
+                     (select fd.description_text
+                        from fnd_descriptions fd,exp_org_unit u
+                        where u.description_id = fd.description_id
+                        and language = 'ZHS'
+                        and  u.unit_id =
+                        (select ep.unit_id from exp_employee_assigns ea, exp_org_position ep
+                        where  ea.employee_id = fb.employee_id
+                        and ea.primary_position_flag = 'Y'  and ea.position_id = ep.position_id)) lease_organization_n,
                      p.employee_id,
                      (select ee.name
                         from exp_employees ee
@@ -129,12 +134,13 @@
                   from hn_prj_plan t1, hn_prj_plan_ln t2
                  where t1.plan_id = t2.plan_id
                    and t2.project_id = p.project_id
-                   and rownum = 1) plan_name
+                   and rownum = 1) plan_name,
+                   fb.submit_by
                 from prj_project p,file_archive_batch fb
                   where
                   --p.content_wfl_status = 'APPROVED'
                   --and p.data_class = 'VIRTUAL_CON'
-                    fb.project_id = p.project_id
+                    fb.project_id = p.project_id(+)
                    --and fb.wfl_status = 'APPROVING'
                     ) t1 #WHERE_CLAUSE#
             ]]></bm:query-sql>
@@ -145,6 +151,33 @@
                   update prj_cdd_item_check pci
                     set pci.confirm_flag = ${@status}
                   where pci.check_id=${@check_id};
+             end;
+            ]]></bm:update-sql>
+        </bm:operation>
+        <bm:operation name="execute">
+            <bm:update-sql><![CDATA[
+            begin
+                  update prj_cdd_item_check pck set pck.confirm_flag = 'Y' where pck.cdd_item_id in
+                    (select pci.cdd_item_id from prj_cdd_item pci, prj_cdd_item_list_grp_tab lgt, prj_cdd_item_tab_group tg
+                    where pci.cdd_list_id = ${@cdd_list_id} and pci.enabled_flag ='Y'
+                                        and lgt.cdd_list_id = pci.cdd_list_id
+                                        AND pci.cdd_item_id  = lgt.cdd_item_id
+                                        AND lgt.TAB_GROUP_ID =tg.TAB_GROUP_ID
+                                        AND nvl(lgt.enabled_flag,'Y') ='Y'
+                                        and nvl(tg.enabled_flag,'Y') = 'Y'
+                                        and tg.tab_group = ${@attachment_tab_group})
+                                        and pck.confirm_flag <> 'M';
+
+                  update prj_cdd_item_check pck set pck.confirm_flag = 'N' where pck.cdd_item_id in
+                    (select pci.cdd_item_id from prj_cdd_item pci, prj_cdd_item_list_grp_tab lgt, prj_cdd_item_tab_group tg
+                    where pci.cdd_list_id = ${@cdd_list_id} and pci.enabled_flag ='Y'
+                                        and lgt.cdd_list_id = pci.cdd_list_id
+                                        AND pci.cdd_item_id  = lgt.cdd_item_id
+                                        AND lgt.TAB_GROUP_ID =tg.TAB_GROUP_ID
+                                        AND nvl(lgt.enabled_flag,'Y') ='Y'
+                                        and nvl(tg.enabled_flag,'Y') = 'Y'
+                                        and tg.tab_group = ${@attachment_tab_group})
+                                        and pck.confirm_flag = 'M';
              end;
             ]]></bm:update-sql>
         </bm:operation>
Index: src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_file_history_entrance.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_file_history_entrance.lview b/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_file_history_entrance.lview
--- a/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_file_history_entrance.lview	(revision 832c448dc170152bf368609ba2827657fb786176)
+++ b/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_file_history_entrance.lview	(revision 0e9240176e00e3688df410598524d1de3a23ed85)
@@ -7,8 +7,8 @@
 -->
 <a:screen xmlns:a="http://www.leaf-framework.org/application" customizationEnabled="true" dynamiccreateenabled="true" trace="true">
     <a:view>
-        <a:link id="con_contract_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
-        <a:link id="prj506_virtual_contract_query_link_id" url="${/request/@context_path}/modules/prj/PRJ506/virtual_contract_query.lview"/>
+        <a:link id="con_contract_get_layout_code_link_id_" model="cont.CON500.con_contract_get_layout_code" modelaction="update"/>
+        <a:link id="prj506_virtual_contract_query_link_id_" url="${/request/@context_path}/modules/prj/PRJ506/virtual_contract_query.lview"/>
         <a:link id="prj_project_modify_link2" url="${/request/@context_path}/modules/prj/PRJ501N/prj_project_create_tree_n.lview"/>
         <a:link id="prj_archive_file_link" url="${/request/@context_path}/modules/acrch/ARCHIVE002/con_contract_file_archive.lview"/>
         <!--<a:link id="prj_archive_batch_link" url="${/request/@context_path}/modules/acrch/ARCHIVE003/archive_file_batch_info.lview"/>-->
@@ -35,7 +35,7 @@
             param['document_type'] = record.get('document_type');
             param['wf_function_code'] = '${/parameter/@function_code}';
             param['winid'] = 'prj501n_main_prj_link_winid';
-            hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'prj_project_modify_link2', ds_id);
+            hls_doc_get_layout_code('con_contract_get_layout_code_link_id_', param, 'prj_project_modify_link2', ds_id);
         }

         function prj506_grid_virtual_con(ds_id,reocrd_id) {
@@ -45,11 +45,11 @@
             param['function_code'] = 'C0N301D_CON';
             param['function_usage'] = 'QUERY';
             param['maintain_type'] = 'READONLY';
-            url_link_id='prj506_virtual_contract_query_link_id';
+            url_link_id='prj506_virtual_contract_query_link_id_';
             param['cond_para2'] = record.get('hn_industry_classification');
             param['url_title'] = '合同明细';
             param['winid'] = 'prj506_virtual_contract_modify_detail_link_id';
-            hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, url_link_id, ds_id);
+            hls_doc_get_layout_code('con_contract_get_layout_code_link_id_', param, url_link_id, ds_id);
         }

         /*function arch003_grid_archive_batch(ds_id,reocrd_id){
@@ -63,7 +63,7 @@
             url_link_id='prj_archive_batch_link';
             param['url_title'] = '档案归档历史记录';
             param['winid'] = 'prj_archive_batch_detail_link_id';
-            hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, url_link_id, ds_id);
+            hls_doc_get_layout_code('con_contract_get_layout_code_link_id_', param, url_link_id, ds_id);
         }*/
         //电子档案归档明细
         function arch003_grid_archive_batch(ds_id,reocrd_id) {
@@ -92,7 +92,7 @@
                 param['submit_type'] = record.get('submit_type');
                 param['url_title'] = '电子档归档明细';
                 param['function_code'] = 'ARCHIVE003_D';
-                hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, url_link_id, ds_id);
+                hls_doc_get_layout_code('con_contract_get_layout_code_link_id_', param, url_link_id, ds_id);
             }
         };

Index: src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_clause_lib_manage_lv_query.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_clause_lib_manage_lv_query.lwm b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_clause_lib_manage_lv_query.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_clause_lib_manage_lv_query.lwm	(revision cdf0e0df69256b2756898172aaae5d5ff1a12dd2)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_clause_lib_manage_lv_query.lwm	(revision 3562c6bc0c9a4ebdc846057c6185e4de752a5936)
@@ -28,6 +28,7 @@
         <bm:field name="date_type" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DATE_TYPE"/>
         <bm:field name="date_type_n" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="DATE_TYPE_N"/>
         <bm:field name="lib_manage_type" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="LIB_MANAGE_TYPE"/>
+        <bm:field name="show_seq" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="SHOW_SEQ"/>
     </bm:fields>
     <bm:features>
         <f:standard-who />
Index: src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_prepayment_clause.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_prepayment_clause.lwm b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_prepayment_clause.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_prepayment_clause.lwm	(revision cdf0e0df69256b2756898172aaae5d5ff1a12dd2)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/hn_prj_prepayment_clause.lwm	(revision d13a9ba1ae1cd96785321a621f1f68fdff147a41)
@@ -21,6 +21,7 @@
         <bm:field name="contract_write_flag" databaseType="VARCHAR2" datatype="java.lang.String" physicalName="CONTRACT_WRITE_FLAG"/>
         <bm:field name="antistop_key" expression="(select hm.antistop_key from hn_prj_clause_lib_manage hm where hm.clause_lib_id = t1.clause_lib_id)" forUpdate="false" forInsert="false"/>
         <bm:field name="third_classification" expression="(select hm.third_classification from hn_prj_clause_lib_manage hm where hm.clause_lib_id = t1.clause_lib_id)" forUpdate="false" forInsert="false"/>
+        <bm:field name="show_seq"   databaseType="VARCHAR2" datatype="java.lang.String" physicalName="SHOW_SEQ"/>
     </bm:fields>
     <bm:features>
         <f:standard-who/>
@@ -49,7 +50,8 @@
                                                              p_pre_cla_content      =>${@pre_cla_content},
                                                              p_seq_number           =>${@seq_number},
                                                              p_contract_write_flag  =>${@contract_write_flag},
-                                                             p_user_id              =>${/session/@user_id});
+                                                             p_user_id              =>${/session/@user_id},
+                                                             p_show_seq             =>${@show_seq});
                 end;
                 ]]></bm:update-sql>
         </bm:operation>
Index: src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_auto_file_detail.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_auto_file_detail.lview b/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_auto_file_detail.lview
--- a/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_auto_file_detail.lview	(revision cdf0e0df69256b2756898172aaae5d5ff1a12dd2)
+++ b/src/main/resources/leaf_static/modules/acrch/ARCHIVE003/archive_auto_file_detail.lview	(revision fce87bbd0e7c858c0859330362dcba736c5a0ffb)
@@ -184,16 +184,10 @@
         }

         Leaf.onReady(()=>{
-            //设置保理 项目报告 签约执行材料 项目 查询地址
-            let ds_arr = ["pro_report_cdd_result_ds", "archive_sign_cdd_result_ds", "archive_bp_cdd_result_ds"]
-            let model_arr = ["${/model/cdd_lease_factor_report_info/record/@tab_group_id}", "${/model/cdd_factor_sign_group_info/record/@tab_group_id}", "${/model/cdd_factor_tenant_group_info/record/@tab_group_id}"]
+            setTimeout(()=>{
+                console.log($("archive_gf_cdd_result_ds"))

-            if('${/parameter/@document_type}' === 'PRJF'){
-                ds_arr.forEach((ds_id, idx)=>{
-                    $(ds_id).setQueryUrl("${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&document_table=FILE_ARCHIVE_BATCH&cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&attachment_tab_group="+ model_arr[idx] +"&confirm_flag=${/parameter/@confirm_flag}")
-                    $(ds_id).query()
-                })
-            }
+            },3000)

             let prj_record = $("arch002_project_info_ds").getAt(0)

@@ -216,7 +210,7 @@
                 return '<a href="javascript:open_payment_attachment_window2(\'' + condition_id+ '\');">附件</a>';
             }
             else{
-                return '<a href="javascript:open_payment_attachment_window(\'' + condition_id+ '\');">附件</a>';
+                return '<a href="javascript:open_payment_attachment_window(\'' + condition_id+ '\');">'+value+'</a>';
             }
         }

@@ -260,6 +254,30 @@
             });
         }

+        function pro_report_query(ds, qpara){
+            if(('${/parameter/@submit_from}' === 'PRJ_PLAN' || '${/parameter/@submit_from}' === 'PRJ_PLAN_CHANGE') && '${/parameter/@document_type}' === 'PRJF') {
+                if('${/parameter/@receive_type}' === 'NOW'){
+                    qpara['attachment_tab_group'] = 'COMPLIANCE_PRJF_NOW'
+                } else{
+                    qpara['attachment_tab_group'] = 'COMPLIANCE_PRJF_FUTURE'
+                }
+            }
+            else{
+                qpara['attachment_tab_group'] = 'PROJECT'
+            }
+            console.log(qpara['attachment_tab_group'])
+        }
+
+        function pro_report_load(ds){
+            ds.getAll().forEach(record =>{
+                if(!record.get("cdd_category")){
+                    record.set("cdd_category", "要件类")
+                }
+            })
+        }
+
+
+
         ]]></script>
         <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.lview"/>
         <a:dataSets>
@@ -268,8 +286,8 @@
                 <a:datas dataSource="/model/project_path"/>
             </a:dataSet>
             <a:dataSet id="archive_bp_cdd_result_ds" autoQuery="true" fetchAll="true"
-                       model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_tenant_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=TENANT&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -286,7 +304,7 @@
             </a:dataSet>
             <a:dataSet id="archive_sd_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_sd_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_sd_group_info/record/@tab_group_id}"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -302,8 +320,8 @@
                 </a:fields>
             </a:dataSet>
             <a:dataSet id="archive_fd_cdd_result_ds" autoQuery="true" fetchAll="true"
-                       model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_fd_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=COMPLIANCE_PRJF&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -317,10 +335,31 @@
                     <a:field name="receive_flag"/>
                     <a:field name="receive_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="receive_flag" valueField="code_value"/>
                 </a:fields>
+                <a:events>
+                    <a:event name="query" handler="pro_report_query"/>
+                </a:events>
             </a:dataSet>
             <a:dataSet id="archive_gf_cdd_result_ds" autoQuery="true" fetchAll="true"
-                       model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_gf_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=COMPLIANCE_PRJF&amp;arch_not_required_flag=N"
+                       selectable="true">
+                <a:fields>
+                    <a:field name="note"/>
+                    <a:field name="description"/>
+                    <a:field name="arch_required_flag"/>
+                    <a:field name="arch_required_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="arch_required_flag" valueField="code_value"/>
+                    <a:field name="arch_par_has_flag"/>
+                    <a:field name="arch_par_has_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="arch_par_has_flag" valueField="code_value"/>
+                    <a:field name="arch_paper_required_flag"/>
+                    <a:field name="arch_paper_required_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="arch_paper_required_flag" valueField="code_value"/>
+                    <a:field name="receive_flag"/>
+                    <a:field name="receive_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="receive_flag" valueField="code_value"/>
+                </a:fields>
+            </a:dataSet>
+<!--            通用合规性材料-->
+            <a:dataSet id="archive_all_cdd_result_ds" autoQuery="true" fetchAll="true"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=COMPLIANCE_PRJF&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -334,10 +373,13 @@
                     <a:field name="receive_flag"/>
                     <a:field name="receive_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="receive_flag" valueField="code_value"/>
                 </a:fields>
+                <a:events>
+                    <a:event name="query" handler="pro_report_query"/>
+                </a:events>
             </a:dataSet>
             <a:dataSet id="archive_within_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_within_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_within_group_info/record/@tab_group_id}"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -354,7 +396,7 @@
             </a:dataSet>
             <a:dataSet id="archive_prjf_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_prjf_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_prjf_group_info/record/@tab_group_id}"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -371,7 +413,7 @@
             </a:dataSet>
             <a:dataSet id="archive_payment_cdd_result_ds" autoQuery="true" fetchAll="true"
                        model="csh.CSH900.hn_con_payment_conditions_detail_new" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/csh.CSH900.hn_con_payment_conditions_detail_new/query?archive_batch_id=${/parameter/@archive_batch_id}&amp;confirm_flag=Y"
+                       queryUrl="${/request/@context_path}/autocrud/csh.CSH900.hn_con_payment_conditions_detail_new/query?archive_batch_id=${/parameter/@archive_batch_id}"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -387,8 +429,8 @@
                 </a:fields>
             </a:dataSet>
             <a:dataSet id="archive_sign_cdd_result_ds" autoQuery="true" fetchAll="true"
-                       model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_sign_group_info/record/@tab_group_id}&amp;confirm_flag=${/parameter/@confirm_flag}"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=SIGN&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -405,8 +447,8 @@
             </a:dataSet>

             <a:dataSet id="pro_report_cdd_result_ds" autoQuery="true" fetchAll="true"
-                       model="layout.server_layout_doc_cdd_item" pageSize="11"
-                       queryUrl="${/request/@context_path}/autocrud/layout.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;attachment_tab_group=${/model/cdd_lease_pro_report_info/record/@tab_group_id}&amp;arch_not_required_flag=N"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;arch_not_required_flag=N"
                        selectable="true">
                 <a:fields>
                     <a:field name="note"/>
@@ -420,11 +462,31 @@
                     <a:field name="receive_flag" defaultValue="Y"/>
                     <a:field name="receive_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="receive_flag" valueField="code_value"/>
                 </a:fields>
+                <a:events>
+                    <a:event name="query" handler="pro_report_query"/>
+                    <a:event name="load" handler="pro_report_load"/>
+                </a:events>
+            </a:dataSet>
+            <a:dataSet id="prj_report_cdd_result_ds" autoQuery="true" fetchAll="true"
+                       model="acrch.ARCHIVE002.server_layout_doc_cdd_item" pageSize="11"
+                       queryUrl="${/request/@context_path}/autocrud/acrch.ARCHIVE002.server_layout_doc_cdd_item/query?base_table_pk=${/parameter/@archive_batch_id}&amp;document_table=FILE_ARCHIVE_BATCH&amp;cdd_list_id=${/model/project_path/record/@arch_cdd_list_id}&amp;arch_not_required_flag=N&amp;attachment_tab_group=PRJ_CHANGE"
+                       selectable="true">
+                <a:fields>
+                    <a:field name="note"/>
+                    <a:field name="description"/>
+                    <a:field name="arch_required_flag" readOnly="true"/>
+                    <a:field name="arch_required_flag_desc" readOnly="true" displayField="code_value_name" options="yes_no_ds" returnField="arch_required_flag" valueField="code_value"/>
+                    <a:field name="arch_par_has_flag" defaultValue="Y"/>
+                    <a:field name="arch_par_has_flag_desc" displayField="code_value_name" options="acrch_type_ds" returnField="arch_par_has_flag" valueField="code_value"/>
+                    <a:field name="arch_paper_required_flag"/>
+                    <a:field name="arch_paper_required_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="arch_paper_required_flag" valueField="code_value"/>
+                    <a:field name="receive_flag" defaultValue="Y"/>
+                    <a:field name="receive_flag_desc" displayField="code_value_name" options="yes_no_ds" returnField="receive_flag" valueField="code_value"/>
+                </a:fields>
             </a:dataSet>
         </a:dataSets>
         <a:screenBody>
             <a:screenTopToolbar>
-                <!-- <a:screenTitle/> -->
                 <a:gridButton click="contract_screen_quit" text="HLS.EXIT"/>
             </a:screenTopToolbar>
             <a:switch test="/parameter/@submit_from">
@@ -434,27 +496,31 @@
                             <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
                             <a:textField name="contract_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
                             <a:textField name="virtual_con_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="项目经理" readOnly="true"/>
+                            <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                            <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
                         </a:hBox>
                     </a:form>
                 </a:case>
-                <a:case value="CON_CHANGE">
+                <a:case value="PAYMENT">
                     <a:form marginWidth="25" title="基本信息">
                         <a:hBox labelWidth="100">
                             <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="contract_number" bindTarget="arch002_project_info_ds" prompt="合同编号" readOnly="true"/>
-                            <a:textField name="virtual_con_name" bindTarget="arch002_project_info_ds" prompt="合同名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="项目经理" readOnly="true"/>
+                            <a:textField name="project_number" bindTarget="arch002_project_info_ds" prompt="项目编号" readOnly="true"/>
+                            <a:textField name="project_name" bindTarget="arch002_project_info_ds" prompt="项目名称" readOnly="true" width="250"/>
+                            <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                            <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
                         </a:hBox>
                     </a:form>
                 </a:case>
+
                 <a:case value="*">
                     <a:form marginWidth="25" title="基本信息">
                         <a:hBox labelWidth="100">
                             <a:textField name="bp_id_tenant_n" bindTarget="arch002_project_info_ds" prompt="承租人名称" width="200" readOnly="true"/>
-                            <a:textField name="project_number" bindTarget="arch002_project_info_ds" prompt="项目编号" readOnly="true"/>
-                            <a:textField name="project_name" bindTarget="arch002_project_info_ds" prompt="项目名称" readOnly="true" width="250"/>
-                            <a:textField name="employee_id_n" bindTarget="arch002_project_info_ds" prompt="项目经理" readOnly="true"/>
+                            <a:textField name="plan_number" bindTarget="arch002_project_info_ds" prompt="项目方案编号" readOnly="true"/>
+                            <a:textField name="plan_name" bindTarget="arch002_project_info_ds" prompt="项目方案名称" readOnly="true" width="250"/>
+                            <a:textField name="submit_by" bindTarget="arch002_project_info_ds" prompt="归档责任人" readOnly="true"/>
+                            <a:textField name="lease_organization_n" bindTarget="arch002_project_info_ds"  prompt="归档部门" readOnly="true"/>
                         </a:hBox>
                     </a:form>
                 </a:case>
@@ -465,47 +531,63 @@
                     <a:tabPanel marginHeight="40" marginWidth="25">
                         <a:tabs>
                             <a:tab prompt="客户资信资料" id="bp_credit_info_id" width="130">
-                                <a:grid id = "archive_file_grid1_id" bindTarget="archive_bp_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                    <a:columns>
-                                        <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                        <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                        <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                        <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                        <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                        <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                        <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                        <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>
-                                        <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                        <a:column name="note" prompt="归档意见" width="300"/>
-                                    </a:columns>
-                                    <a:editors>
-                                        <a:comboBox id="archive_grid1_cb"/>
-                                    </a:editors>
-                                </a:grid>
+                                <a:tabPanel height="400" marginWidth="50">
+                                    <a:tabs>
+                                        <a:tab prompt="归档材料清单" width="140">
+                                            <a:grid id = "archive_file_grid1_id" bindTarget="archive_bp_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+                                                <a:columns>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
+                                                    <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid1_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid1_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid1_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid1_tf"/>
+                                                </a:columns>
+                                                <a:editors>
+                                                    <a:comboBox id="archive_grid1_cb"/>
+                                                </a:editors>
+                                            </a:grid>
+                                        </a:tab>
+                                    </a:tabs>
+                                </a:tabPanel>
                             </a:tab>
-                            <a:placeHolder id="hn_binary_record_tab"/>
-                            <a:placeHolder id="hn_document_type_record_tab"/>
-                            <a:placeHolder id="hn_industry_record_tab"/>

-                            <a:tab prompt="项目报告" id="pro_report_info_id" width="130">
+                            <a:tab prompt="合规性材料" id="change_report_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
                                         <a:tab prompt="归档材料清单" width="140">
-                                            <a:grid id = "archive_file_grid11_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+                                            <a:grid id = "archive_file_grid13_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+
                                                 <a:columns>
-                                                    <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                    <a:column name="cdd_category" prompt="文档类别" width="80"  />                                                    <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                    <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                     <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
                                                     <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                    <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                    <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>
-                                                    <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                    <a:column name="note" prompt="归档意见" width="300" editor="archive_grid1_tf" readOnly="true"/>
+                                                    <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
+                                                    <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
+                                                    <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid12_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid12_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid12_cb" width="100"/>
+                                                    <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
+                                                    <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid12_tf"/>
                                                 </a:columns>
                                                 <a:editors>
-                                                    <a:comboBox id="archive_grid11_cb"/>
-                                                    <a:textField id="archive_grid11_tf"/>
+                                                    <a:comboBox id="archive_grid12_cb"/>
+                                                    <a:textField id="archive_grid12_tf"/>
+
+                                                    <a:numberField id="archive_grid12_nf" allowDecimals="false"/>
                                                 </a:editors>
                                             </a:grid>
                                         </a:tab>
@@ -522,23 +604,22 @@
                             <a:tab prompt="放款前提材料" id="bp_credit_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
-                                        <a:tab prompt="档案归档资料附件" width="140">
+                                        <a:tab prompt="归档材料清单" width="140">
                                             <a:grid id = "archive_file_grid8_id" bindTarget="archive_payment_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                 <a:columns>
-                                                    <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                    <a:column name="cdd_category" prompt="文档类别" width="80" />
-                                                    <a:column name="cdd_class"  prompt="资料分类" width="100"/>
-                                                    <a:column name="description"  prompt="HLS.DOCUMENT_NAME"  width="200"/>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                     <a:column name="attachment_payment2"   prompt="附件" renderer="payment_cdd_render_func" width="100"/>
-                                                    <a:column name="file_name2"  prompt="附件名"   width="300"/>
-                                                    <!--<a:column name="attachment_payment"   prompt="附件(放款前提)" renderer="payment_cdd_render_func" width="100"/>-->
-                                                    <!--<a:column name="file_name"  prompt="附件名(放款前提)"   width="300"/>-->
-                                                    <a:column name="arch_required_flag_desc"  prompt="是否必传"  width="100"/>
-                                                    <!--<a:column name="arch_par_has_flag_desc"  prompt="是否有纸质资料"  width="100"/>-->
-                                                    <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料"  width="120"/>
-                                                    <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料"  width="110"/>-->
-                                                    <a:column name="creation_date_s" prompt="归档日期" width="110" />
-                                                    <a:column name="note" prompt="归档意见" width="300" readOnly="true"/>
+                                                    <a:column name="file_name"  prompt="附件名" renderer="payment_cdd_render_func" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid8_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid8_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid8_cb" width="100"/>
+                                                    <a:column name="creation_date_s" prompt="归档日期" width="110"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid8_tf"/>
+
                                                 </a:columns>
                                                 <a:editors>
                                                     <a:comboBox id="archive_grid7_cb"/>
@@ -558,19 +639,21 @@
                             <a:tab prompt="签约执行材料" id="bp_credit_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
-                                        <a:tab prompt="档案归档资料附件" width="140">
+                                        <a:tab prompt="归档材料清单" width="140">
                                             <a:grid id = "archive_file_grid9_id" bindTarget="archive_sign_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                 <a:columns>
-                                                    <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                    <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                    <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                    <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                     <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
                                                     <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                    <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                    <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid9_cb" width="100"/>
-                                                    <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                    <a:column name="note" prompt="归档意见" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid9_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid9_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid9_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid9_tf"/>
                                                 </a:columns>
                                                 <a:editors>
                                                     <a:comboBox id="archive_grid9_cb"/>
@@ -584,25 +667,27 @@
                     </a:tabPanel>
                 </a:case>
                 <!--项目变更-->
-                <a:case value="PRJ_CHANGE">
+                <a:case value="PRJ_PLAN_CHANGE">
                     <a:tabPanel marginHeight="40" marginWidth="25">
                         <a:tabs>
                             <a:tab prompt="客户资信资料" id="bp_credit_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
-                                        <a:tab prompt="档案归档资料附件" width="140">
+                                        <a:tab prompt="归档材料清单" width="140">
                                             <a:grid id = "archive_file_grid1_id" bindTarget="archive_bp_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                 <a:columns>
-                                                    <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                    <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                    <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                    <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                     <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
                                                     <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                    <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                    <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>
-                                                    <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                    <a:column name="note" prompt="归档意见" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号"  width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid1_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid1_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" />
                                                 </a:columns>
                                                 <a:editors>
                                                     <a:comboBox id="archive_grid1_cb"/>
@@ -612,38 +697,49 @@
                                     </a:tabs>
                                 </a:tabPanel>
                             </a:tab>
-                            <a:placeHolder id="hn_change_binary_record_tab"/>
-                            <a:placeHolder id="hn_change_document_type_record_tab"/>
-                            <a:placeHolder id="hn_change_industry_record_tab"/>

-                            <a:tab prompt="项目报告" id="change_report_info_id" width="130">
+                            <a:tab prompt="合规性材料" id="change_report_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
-                                    <a:tab prompt="归档材料清单" width="140">
-                                        <a:grid id = "archive_file_grid12_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category" prompt="文档类别" width="80" />                                                    <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300" editor="archive_grid1_tf" readOnly="true"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid12_cb"/>
-                                                <a:textField id="archive_grid12_tf"/>
-                                            </a:editors>
-                                        </a:grid>
+                                        <a:tab prompt="归档材料清单" width="140">
+                                            <a:grid id = "archive_file_grid13_id" bindTarget="pro_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+
+                                                <a:columns>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
+                                                    <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
+                                                    <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
+                                                    <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
+                                                    <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid12_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid12_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid12_cb" width="100"/>
+                                                    <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
+                                                    <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid12_tf"/>
+                                                </a:columns>
+                                                <a:editors>
+                                                    <a:comboBox id="archive_grid12_cb"/>
+                                                    <a:textField id="archive_grid12_tf"/>
+
+                                                    <a:numberField id="archive_grid12_nf" allowDecimals="false"/>
+                                                </a:editors>
+                                            </a:grid>
                                         </a:tab>
                                     </a:tabs>
                                 </a:tabPanel>
                             </a:tab>
+
+
                         </a:tabs>
                     </a:tabPanel>
                 </a:case>
+
                 <!--SIGN 合同审批以及签约工作流-->
                 <a:case value="CON_CHANGE">
                     <a:tabPanel marginHeight="40" marginWidth="25">
@@ -651,19 +747,21 @@
                             <a:tab prompt="签约执行材料" id="bp_credit_info_id" width="130">
                                 <a:tabPanel height="400" marginWidth="50">
                                     <a:tabs>
-                                        <a:tab prompt="档案归档资料附件" width="140">
+                                        <a:tab prompt="归档材料清单" width="140">
                                             <a:grid id = "archive_file_grid10_id" bindTarget="archive_sign_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
                                                 <a:columns>
-                                                    <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                    <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                    <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                    <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
                                                     <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
                                                     <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                    <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                    <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid10_cb" width="100"/>
-                                                    <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                    <a:column name="note" prompt="归档意见" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid1_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid1_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid1_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid1_tf"/>
                                                 </a:columns>
                                                 <a:editors>
                                                     <a:comboBox id="archive_grid10_cb"/>
@@ -676,415 +774,117 @@
                         </a:tabs>
                     </a:tabPanel>
                 </a:case>
-            </a:switch>
-        </a:screenBody>
-    </a:view>
-    <a:view-config>
-        <c:create-config targetId="hn_binary_record_tab">
-            <p:switch test="/parameter/@binary_classification">
-                <p:case value="WIND_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（风电）" width="130" id="prj_project_wind_power_tab">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid2_id" bindTarget="archive_fd_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid2_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid2_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-                <p:case value="LIGHT_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（光伏）" width="130" id="prj_project_light_power_tab">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid3_id" bindTarget="archive_gf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid3_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid3_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-                <!--<p:case value="SELF_PHOTOELECTRIC">-->
-                <!--<c:process-config>-->
-                <!--<a:tab prompt="合规性资料（光伏）" width="130">-->
-                <!--<a:tabPanel height="400" marginWidth="50">-->
-                <!--<a:tabs>-->
-                <!--<a:tab prompt="档案归档资料附件" width="140">-->
-                <!--<a:grid id = "archive_file_grid4_id" bindTarget="archive_gf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">-->
-                <!--<a:columns>-->
-                <!--<a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>-->
-                <!--<a:column name="cdd_class"  prompt="资料分类" width="200"/>-->
-                <!--<a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>-->
-                <!--<a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>-->
-                <!--<a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>-->
-                <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid4_cb" width="100"/>-->
-                <!--<a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>-->
-                <!--<a:column name="note" prompt="归档意见" width="300"/>-->
-                <!--</a:columns>-->
-                <!--<a:editors>-->
-                <!--<a:comboBox id="archive_grid4_cb"/>-->
-                <!--</a:editors>-->
-                <!--</a:grid>-->
-                <!--</a:tab>-->
-                <!--</a:tabs>-->
-                <!--</a:tabPanel>-->
-                <!--</a:tab>-->
-                <!--</c:process-config>-->
-                <!--</p:case>-->
-                <p:case value="WATER_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（水电）" width="130" id="prj_project_water_power_tab">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid5_id" bindTarget="archive_sd_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid5_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid5_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-        <c:create-config targetId="hn_document_type_record_tab">
-            <p:switch test="/parameter/@document_type">
-                <p:case value="PRJF">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（保理）" width="130">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid6_id" bindTarget="archive_prjf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid6_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid6_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-        <c:create-config targetId="hn_industry_record_tab">
-            <p:switch test="/parameter/@hn_industry_classification">
-                <p:case value="WITHIN_GROUP">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（集团）" width="130">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid7_id" bindTarget="archive_within_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid7_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid7_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-        <c:create-config targetId="hn_change_binary_record_tab">
-            <p:switch test="/parameter/@binary_classification">
-                <p:case value="WIND_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（风电）" width="130" id="tab_prj_change_fd">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid2_id" bindTarget="archive_fd_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid2_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid2_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-                <p:case value="LIGHT_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（光伏）" width="130"  id="tab_prj_change_gf">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid3_id" bindTarget="archive_gf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <!--<a:toolBar>-->
-                                            <!--<a:button id="mark_btn3" click="arch002_atm_grid_mark" text="标记"/>-->
-                                            <!--<a:button id="dismark_btn3" click="arch002_atm_grid_dismark" text="取消标记"/>-->
-                                            <!--<a:button id="save_btn3" type="save"/>-->
-                                            <!--<a:button id="confirm_btn3" click="arch002_atm_grid_confirm" text="确认"/>-->
-                                            <!--<a:button id="cancel_btn3" text="取消" click="arch002_atm_grid_cancel"/>-->
-
-                                            <!--</a:toolBar>-->
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid3_cb" width="100"/>
-                                                <a:column name="arch_par_has_flag_desc"  prompt="是否有纸质资料" editor="archive_grid3_cb" width="100"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid3_cb" width="120"/>
-                                                <a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid3_cb" width="110"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300" editor="archive_grid3_tf" readOnly="true"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid3_cb"/>
-                                                <a:textField id="archive_grid3_tf"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-                <!--<p:case value="LIGHT_POWER">-->
-                <!--<c:process-config>-->
-                <!--<a:tab prompt="合规性资料（光伏）" width="130">-->
-                <!--<a:tabPanel height="400" marginWidth="50">-->
-                <!--<a:tabs>-->
-                <!--<a:tab prompt="档案归档资料附件" width="140">-->
-                <!--<a:grid id = "archive_file_grid3_id" bindTarget="archive_gf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">-->
-                <!--<a:columns>-->
-                <!--<a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>-->
-                <!--<a:column name="cdd_class"  prompt="资料分类" width="200"/>-->
-                <!--<a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>-->
-                <!--<a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>-->
-                <!--<a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>-->
-                <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid3_cb" width="100"/>-->
-                <!--<a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>-->
-                <!--<a:column name="note" prompt="归档意见" width="300"/>-->
-                <!--</a:columns>-->
-                <!--<a:editors>-->
-                <!--<a:comboBox id="archive_grid3_cb"/>-->
-                <!--</a:editors>-->
-                <!--</a:grid>-->
-                <!--</a:tab>-->
-                <!--</a:tabs>-->
-                <!--</a:tabPanel>-->
-                <!--</a:tab>-->
-                <!--</c:process-config>-->
-                <!--</p:case>-->
-                <!--<p:case value="SELF_PHOTOELECTRIC">-->
-                <!--<c:process-config>-->
-                <!--<a:tab prompt="合规性资料（光伏）" width="130">-->
-                <!--<a:tabPanel height="400" marginWidth="50">-->
-                <!--<a:tabs>-->
-                <!--<a:tab prompt="档案归档资料附件" width="140">-->
-                <!--<a:grid id = "archive_file_grid4_id" bindTarget="archive_gf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">-->
-                <!--<a:columns>-->
-                <!--<a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>-->
-                <!--<a:column name="cdd_class"  prompt="资料分类" width="200"/>-->
-                <!--<a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>-->
-                <!--<a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>-->
-                <!--<a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>-->
-                <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid4_cb" width="100"/>-->
-                <!--<a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>-->
-                <!--<a:column name="note" prompt="归档意见" width="300"/>-->
-                <!--</a:columns>-->
-                <!--<a:editors>-->
-                <!--<a:comboBox id="archive_grid4_cb"/>-->
-                <!--</a:editors>-->
-                <!--</a:grid>-->
-                <!--</a:tab>-->
-                <!--</a:tabs>-->
-                <!--</a:tabPanel>-->
-                <!--</a:tab>-->
-                <!--</c:process-config>-->
-                <!--</p:case>-->
-                <p:case value="WATER_POWER">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（水电）" width="130" id="tab_prj_change_sd">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid5_id" bindTarget="archive_sd_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid5_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid5_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-        <c:create-config targetId="hn_change_document_type_record_tab">
-            <p:switch test="/parameter/@document_type">
-                <p:case value="PRJF">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（保理）" width="130">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid6_id" bindTarget="archive_prjf_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid6_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid6_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-        <c:create-config targetId="hn_change_industry_record_tab">
-            <p:switch test="/parameter/@hn_industry_classification">
-                <p:case value="WITHIN_GROUP">
-                    <c:process-config>
-                        <a:tab prompt="合规性资料（集团）" width="130">
-                            <a:tabPanel height="400" marginWidth="50">
-                                <a:tabs>
-                                    <a:tab prompt="档案归档资料附件" width="140">
-                                        <a:grid id = "archive_file_grid7_id" bindTarget="archive_within_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
-                                            <a:columns>
-                                                <a:column name="seq_num"  prompt="序号" width="30" renderer="project_cdd_render_func"/>
-                                                <a:column name="cdd_category"  prompt="文档类别" width="80"/>
-                                                <a:column name="cdd_class"  prompt="资料分类" width="200"/>
-                                                <a:column name="description"  prompt="HLS.DOCUMENT_NAME" renderer="project_cdd_render_func" width="200"/>
-                                                <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
-                                                <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
-                                                <a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" width="120"/>
-                                                <a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid7_cb" width="100"/>
-                                                <a:column name="creation_date" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
-                                                <a:column name="note" prompt="归档意见" width="300"/>
-                                            </a:columns>
-                                            <a:editors>
-                                                <a:comboBox id="archive_grid7_cb"/>
-                                            </a:editors>
-                                        </a:grid>
-                                    </a:tab>
-                                </a:tabs>
-                            </a:tabPanel>
-                        </a:tab>
-                    </c:process-config>
-                </p:case>
-            </p:switch>
-        </c:create-config>
-    </a:view-config>
+<!--                项目报告-->
+                <a:case value="PRJ_PLAN_REPORT">
+                    <a:tabPanel marginHeight="40" marginWidth="25" id="prj_plan_report_tabs">
+                        <a:tabs>
+                            <a:tab prompt="项目报告" id="pro_report_info_id" width="130">
+                                <a:tabPanel height="400" marginWidth="50">
+                                    <a:tabs>
+                                        <a:tab prompt="归档材料清单" width="140">
+                                            <a:grid id = "archive_file_grid11_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+                                                <a:columns>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
+                                                    <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid14_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid14_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid14_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid14_tf"/>
+                                                </a:columns>
+                                                <a:editors>
+                                                    <a:comboBox id="archive_grid11_cb"/>
+                                                    <a:textField id="archive_grid11_tf"/>
+                                                </a:editors>
+                                            </a:grid>
+                                        </a:tab>
+                                    </a:tabs>
+                                </a:tabPanel>
+                            </a:tab>
+                        </a:tabs>
+                    </a:tabPanel>
+                </a:case>
+                <a:case value="PRJ_PLAN_REPORT_CHANGE_A">
+                    <a:tabPanel marginHeight="40" marginWidth="25" id="prj_plan_report_tabs">
+                        <a:tabs>
+                            <a:tab prompt="项目报告" id="change_report_info_id" width="130">
+                                <a:tabPanel height="400" marginWidth="50">
+                                    <a:tabs>
+                                        <a:tab prompt="归档材料清单" width="140">
+                                            <a:grid id = "archive_file_grid12_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+                                                <a:columns>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
+                                                    <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
+                                                    <!--<a:column name="plan_bp_attachment" prompt="附件(项目方案)" renderer="project_cdd_render_func" width="100"/>-->
+                                                    <!--<a:column name="plan_attach_file_name"  prompt="附件名(项目方案)" renderer="project_cdd_render_func" width="300"/>-->
+                                                    <!--<a:column name="arch_required_flag_desc"  prompt="是否必传" editor="archive_grid1_cb" width="100"/>-->
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid14_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid14_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid14_cb" width="100"/>
+                                                    <!--<a:column name="arch_paper_required_flag_desc"  prompt="是否为重要资料" editor="archive_grid1_cb" width="120"/>-->
+                                                    <!--<a:column name="receive_flag_desc"  prompt="是否收到纸质资料" editor="archive_grid1_cb" width="110"/>-->
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid14_tf"/>
+                                                </a:columns>
+                                                <a:editors>
+                                                    <a:comboBox id="archive_grid12_cb"/>
+                                                    <a:textField id="archive_grid12_tf"/>
+                                                </a:editors>
+                                            </a:grid>
+                                        </a:tab>
+                                    </a:tabs>
+                                </a:tabPanel>
+                            </a:tab>
+                        </a:tabs>
+                    </a:tabPanel>
+                </a:case>
+
+                <a:case value="PRJ_PLAN_REPORT_CHANGE_B">
+                    <a:tabPanel marginHeight="40" marginWidth="25" id="prj_plan_report_tabs">
+                        <a:tabs>
+                            <a:tab prompt="项目报告" id="change_report_info_id" width="130">
+                                <a:tabPanel height="400" marginWidth="50">
+                                    <a:tabs>
+                                        <a:tab prompt="归档材料清单" width="140">
+                                            <a:grid id = "archive_file_grid12_id" bindTarget="prj_report_cdd_result_ds" marginHeight="200" marginWidth="45" navBar="true">
+                                                <a:columns>
+                                                    <a:column name="cdd_category" prompt="文件类型" width="80" />
+                                                    <a:column name="order_num"  prompt="序号" width="30"/>
+                                                    <a:column name="show_seq"  prompt="重要文件" width="100"/>
+                                                    <a:column name="cdd_class"  prompt="文件分类" width="120"/>
+                                                    <a:column name="description"  prompt="归档范围（资料名称）" renderer="project_cdd_render_func" width="200"/>
+                                                    <a:column name="attachment"   prompt="附件" renderer="project_cdd_render_func" width="100"/>
+                                                    <a:column name="attach_file_name"  prompt="附件名" renderer="project_cdd_render_func" width="300"/>
+                                                    <a:column name="important_concerns"  prompt="文号" editor="archive_grid14_tf" width="100"/>
+                                                    <a:column name="sign_num"  prompt="份数" editor="archive_grid14_nf" width="100"/>
+                                                    <a:column name="arch_par_has_flag_desc"  prompt="归档形式" editor="archive_grid14_cb" width="100"/>
+                                                    <a:column name="creatiodate" prompt="归档日期" width="110" renderer="Leaf.formatDate"/>
+                                                    <a:column name="note" prompt="说明" width="300" editor="archive_grid14_tf"/>
+                                                </a:columns>
+                                                <a:editors>
+                                                    <a:comboBox id="archive_grid12_cb"/>
+                                                    <a:textField id="archive_grid12_tf"/>
+                                                </a:editors>
+                                            </a:grid>
+                                        </a:tab>
+                                    </a:tabs>
+                                </a:tabPanel>
+                            </a:tab>
+                        </a:tabs>
+                    </a:tabPanel>
+                </a:case>
+            </a:switch>
+        </a:screenBody>
+    </a:view>
+
 </a:screen>
Index: src/main/resources/leaf_static/modules/prj/PRJ301/prj_chance_query.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ301/prj_chance_query.lview b/src/main/resources/leaf_static/modules/prj/PRJ301/prj_chance_query.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ301/prj_chance_query.lview	(revision cdf0e0df69256b2756898172aaae5d5ff1a12dd2)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ301/prj_chance_query.lview	(revision 3562c6bc0c9a4ebdc846057c6185e4de752a5936)
@@ -32,7 +32,7 @@
             }

             function chanceMaintainDs_grid_clear() {
-                $('chanceMaintainDs_grid').clear();
+                $('chanceMaintain_paraDs').reset();
             }

             function chanceMaintainDs_grid_update(id, chance_id, status,hn_industry_classification) {
@@ -237,7 +237,7 @@
                 <a:screenTitle/>
                 <!-- <a:gridButton click="chanceMaintainScreen_quit" text="HLS.EXIT"/> -->
                 <a:gridButton click="chanceMaintainDs_grid_query" text="HLS.QUERY"/>
-                <a:gridButton click="chanceMaintainDs_grid_clear" text="HLS.CLEAR"/>
+                <a:gridButton click="chanceMaintainDs_grid_clear" text="重置"/>
                 <a:gridButton click="project_application_form_print" text="生成立项申请表"/>
                 <a:gridButton click="letter_of_intention_form_print" text="生成意向函"/>
             </a:screenTopToolbar>
Index: src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_prepayment_clause.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_prepayment_clause.lview b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_prepayment_clause.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_prepayment_clause.lview	(revision cdf0e0df69256b2756898172aaae5d5ff1a12dd2)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_prepayment_clause.lview	(revision d13a9ba1ae1cd96785321a621f1f68fdff147a41)
@@ -25,7 +25,9 @@
             Leaf.Masker.unmask(Ext.getBody());
         }
         function prj_prepayment_clause_save() {
+
             var ds = $('prj_prepayment_clause_ds');
+
             if (ds.validate()) {
                 var records = ds.getAll();
                 var saveData = [];
@@ -42,8 +44,10 @@
                     array['pre_cla_type'] = record.get('pre_cla_type');
                     array['pre_cla_content'] = record.get('pre_cla_content');
                     array['contract_write_flag'] = record.get('contract_write_flag');
+                    array['show_seq'] = record.get('show_seq')
                     saveData.push(array);
                 }
+                console.log(saveData)
                 Leaf.showConfirm('提示', '确认进行保存么?', function () {
                     lock_current_window();
                     Leaf.request({
@@ -140,6 +144,10 @@
                 $('prj_prepayment_clause_ds').query();
             });
         }
+
+        function test(){
+            console.log($("prj_prepayment_clause_ds"))
+        }
         ]]></script>
         <a:dataSets>
             <a:dataSet id="violate_claim_ds" lookupCode="PRJ501Z_VIOLATE_CLAIM_TYPE"/>
@@ -160,10 +168,12 @@
                             <a:map from="content_overview" to="pre_cla_content"/>
                             <a:map from="antistop_key" to="antistop_key"/>
                             <a:map from="third_classification" to="third_classification"/>
+                            <a:map from="show_seq" to="show_seq"/>
                         </a:mapping>
                     </a:field>
                     <a:field name="antistop_key"/>
                     <a:field name="third_classification"/>
+                    <a:field name="show_seq"/>
                     <a:field name="clause_lib_id"/>
                     <a:field name="pre_cla_type" />
                     <a:field name="pre_cla_content" readOnly="true"/>
@@ -187,6 +197,7 @@
                             <a:button click="prj_prepayment_clause_save" text="保存" icon="${/request/@context_path}/images/save.png"/>
                             <a:button click="prj_prepayment_clause_list" text="多选" icon="${/request/@context_path}/images/save.png"/>
                             <a:button type="delete"/>
+                            <a:button click="test" text="test"/>
                         </a:toolBar>
                         <a:columns>
                             <a:column name="seq_number" width="80" align="center" prompt="序号"/>
@@ -195,6 +206,7 @@
                             <a:column name="third_classification" width="120" align="left" prompt="三级分类"/>
                             <a:column name="pre_cla_content" width="520" align="left" prompt="落实条件" renderer="pre_cla_content_renderer" editor="prepayment_clause_ta"/>
                             <a:column name="contract_write_flag" editor="prj_manage_cbx" prompt="不写入合同" width="100"/>
+                            <a:column name="show_seq" width="100" prompt="重要文件标识"/>
                         </a:columns>
                         <a:editors>
                             <a:lov id="prepayment_clause_lov"/>
Index: src/main/resources/leaf_static/WEB-INF/classes/layout/server_layout_doc_cdd_item.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/layout/server_layout_doc_cdd_item.lwm b/src/main/resources/leaf_static/WEB-INF/classes/layout/server_layout_doc_cdd_item.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/layout/server_layout_doc_cdd_item.lwm	(revision 2d5a898af265df271d328ec598ff74ddf3722d3a)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/layout/server_layout_doc_cdd_item.lwm	(revision 89ab5b92365aa12c4ddf3ba97f10efd1f42f9234)
@@ -63,7 +63,7 @@
               --add by zc 资料清单优化
               pp.important_concerns,
               NVL(pp.investigate_guide_flag,'Y') as investigate_guide_flag,
-              (select v.code_value_name from sys_code_values_v v where v.code = 'YES_NO' and v.code_value=NVL(pp.investigate_guide_flag,'Y')) investigate_guide_flag_n,
+              (select v.code_value_name from sys_code_values_v v where v.code = 'PRJ_PLAN_ATTACHMENT_INVESTIGATE_GUIDE_FLAG' and v.code_value=NVL(pp.investigate_guide_flag,'Y')) investigate_guide_flag_n,
               pp.reason_alternative,
               --end
                     (select ct.content_print_flag from con_contract_content ct where ct.check_id = pp.check_id) content_print_flag,
@@ -112,6 +112,7 @@
                     pci.lender_tab_group,
                     nvl(pci.arch_required_flag, 'Y') arch_required_flag,/*add zc 归档必传标识*/
                     nvl(pci.arch_par_has_flag,'Y') arch_par_has_flag,
+                    (select v.code_value_name from sys_code_values_v v where v.code = 'ACRCH_TYPE' and v.code_value= nvl(pci.arch_par_has_flag,'Y')) arch_par_has_flag_desc,
                     pci.arch_paper_required_flag,
                     tg.tab_group_id,
                     tg.tab_group attachment_tab_group,
@@ -191,7 +192,7 @@
               pck.confirm_flag,
               pck.important_concerns,
               pck.investigate_guide_flag,
-              (select  v.code_value_name from sys_code_values_v v where v.code = 'YES_NO_ALL' and v.code_value=pck.investigate_guide_flag) investigate_guide_flag_n,
+              (select  v.code_value_name from sys_code_values_v v where v.code = 'PRJ_PLAN_ATTACHMENT_INVESTIGATE_GUIDE_FLAG' and v.code_value=pck.investigate_guide_flag) investigate_guide_flag_n,
               pck.reason_alternative
                     FROM
                         prj_cdd_item_doc_ref pcf,
@@ -223,7 +224,7 @@
                     and nvl(pci.arch_required_flag, 'Y') not in nvl(${@arch_not_required_flag},' ')
                     and ((nvl(${@confirm_flag},'N')='Y' AND pp.confirm_flag='Y') or nvl(${@confirm_flag},'N')='N')

-                    )v   ORDER BY v.file_count,v.confirm_flag,v.creation_date,v.seq_num ASC) t1 #WHERE_CLAUSE#
+                    )v   ORDER BY v.file_count,v.order_seq,v.confirm_flag,v.creation_date ASC) t1 #WHERE_CLAUSE#


             ]]></bm:query-sql>
@@ -468,6 +469,7 @@
         <bm:field name="sign_num"/>
         <bm:field name="arch_required_flag"/>
         <bm:field name="arch_par_has_flag"/>
+        <bm:field name="arch_par_has_flag_desc"/>
         <bm:field name="arch_paper_required_flag"/>
         <bm:field name="receive_flag"/>
         <bm:field name="mark_flag"/>
Index: src/main/resources/leaf_static/WEB-INF/server-script/layoutconfig/archive_file_his_entrance_g_project_result_queryfields.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/server-script/layoutconfig/archive_file_his_entrance_g_project_result_queryfields.js b/src/main/resources/leaf_static/WEB-INF/server-script/layoutconfig/archive_file_his_entrance_g_project_result_queryfields.js
--- a/src/main/resources/leaf_static/WEB-INF/server-script/layoutconfig/archive_file_his_entrance_g_project_result_queryfields.js	(revision 2d5a898af265df271d328ec598ff74ddf3722d3a)
+++ b/src/main/resources/leaf_static/WEB-INF/server-script/layoutconfig/archive_file_his_entrance_g_project_result_queryfields.js	(revision 0a5302100ce6731a70d44ba64c98c53dd2713965)
@@ -8,4 +8,13 @@
 		"   and v.role_code = 'ARCHIVIST')>0))"
 }];

+var override_queryfields = [
+	{
+		name:'months',
+		queryexpression:"t1.months=${@months}"
+	}
+];
+
 add_datafilter();
+override();
+
Index: src/main/resources/leaf_static/WEB-INF/classes/hn/HN12001/hn_capital_plan_wfl_update_not_approved.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/hn/HN12001/hn_capital_plan_wfl_update_not_approved.lwm b/src/main/resources/leaf_static/WEB-INF/classes/hn/HN12001/hn_capital_plan_wfl_update_not_approved.lwm
new file mode 100644
--- /dev/null	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/hn/HN12001/hn_capital_plan_wfl_update_not_approved.lwm	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
@@ -0,0 +1,81 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+    $Author: zxt
+    $Date: 2016-4-27 上午10:52:06
+    $Revision: 1.0
+    $Purpose:
+-->
+<bm:model xmlns:bm="http://www.leaf-framework.org/schema/bm">
+    <bm:operations>
+        <bm:operation name="query">
+            <bm:query-sql><![CDATA[
+      select * from (select hb.batch_id,
+               hb.batch_number,
+               (select su.description from sys_user su where hw.created_by=su.user_id) create_by_desc,
+               to_char(hb.fill_date_from, 'yyyy-mm-dd') fill_date_from,
+               to_char(hb.fill_date_to, 'yyyy-mm-dd') fill_date_to,
+               to_char(hb.examine_date_from, 'yyyy-mm-dd') examine_date_from,
+               to_char(hb.examine_date_to, 'yyyy-mm-dd') examine_date_to,
+               hb.batch_status,
+               (select sv.code_value_name
+                  from sys_code_values_v sv
+                 where sv.code = 'HN_CAPITAL_BATCH_STATUS'
+                   and sv.code_value = hb.batch_status) batch_status_n,
+               nvl(hw.approved_status, 'NEW') approved_status,
+               (select sv.code_value_name
+                  from sys_code_values_v sv
+                 where sv.code = 'HN_APPROVE_STATUS'
+                   and sv.code_value = nvl(hw.approved_status, 'NEW')) approved_status_n,
+               nvl(hw.user_id, ${/session/@user_id}) user_id,
+                (select hd.org_name
+          from hn_group_org_hd hd,hn_group_org_ln ln
+         where hd.org_hd_id = ln.org_hd_id
+         and ln.org_user_id=nvl(hw.user_id,${/session/@user_id})
+         and hd.assign_type ='ORG'
+         and hd.enable_flag ='Y'
+         and rownum=1
+         ) org_name,
+               nvl(hw.data_class, 'NORMAL') data_class,
+               hw.batch_wfl_id
+          from hn_capital_plan_batch hb, hn_capital_plan_wfl hw
+         where hw.batch_id = hb.batch_id
+           and hw.data_class = 'NORMAL' and hw.approved_status <> 'APPROVED'
+        ) t1
+ #WHERE_CLAUSE#
+ order by t1.batch_id desc
+ ]]></bm:query-sql>
+        </bm:operation>
+        <bm:operation name="update">
+            <bm:update-sql><![CDATA[
+                 begin
+                    hn_capital_plan_pkg.update_capital_plan_wfl(p_batch_id => ${@batch_id},
+                                                          p_user_id  => ${/session/@user_id});
+                  end;
+                ]]></bm:update-sql>
+        </bm:operation>
+        <bm:operation name="execute">
+            <bm:update-sql><![CDATA[
+                BEGIN
+                  hn_capital_plan_pkg.hn_capital_plan_change(p_batch_id  =>${@batch_id},
+                                                         p_user_id => ${/session/@user_id});
+                END;
+                ]]></bm:update-sql>
+        </bm:operation>
+    </bm:operations>
+    <bm:query-fields>
+        <bm:query-field name="batch_number"
+                        queryExpression="t1.batch_number like &apos;%&apos;||${@batch_number}||&apos;%&apos;"/>
+        <bm:query-field name="fill_date_from" queryExpression="t1.fill_date_from=${@fill_date_from}"/>
+        <bm:query-field name="fill_date_to" queryExpression="t1.fill_date_to=${@fill_date_to}"/>
+        <bm:query-field name="examine_date_from" queryExpression="t1.examine_date_from=${@examine_date_from}"/>
+        <bm:query-field name="examine_date_to" queryExpression="t1.examine_date_to=${@examine_date_to}"/>
+        <bm:query-field name="batch_status"
+                        queryExpression="t1.batch_status like &apos;%&apos;||${@batch_status}||&apos;%&apos;"/>
+        <bm:query-field name="approved_status"
+                        queryExpression="t1.approved_status = ${@approved_status}"/>
+    </bm:query-fields>
+    <bm:data-filters>
+        <bm:data-filter name="query"
+                        expression=" t1.data_class =&apos;NORMAL&apos; and t1.batch_status =&apos;RUNNING&apos;"/>
+    </bm:data-filters>
+</bm:model>
Index: src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/prj_clause_lib_contract_lov.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/prj_clause_lib_contract_lov.lwm b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/prj_clause_lib_contract_lov.lwm
--- a/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/prj_clause_lib_contract_lov.lwm	(revision d6dd03524c84402681f916566b577d8e2176b602)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/prj/PRJ501Z/prj_clause_lib_contract_lov.lwm	(revision d13a9ba1ae1cd96785321a621f1f68fdff147a41)
@@ -28,6 +28,8 @@
                   physicalName="DOCUMENT_CATEGORY_N" prompt="单据类别"/>
         <bm:field name="clause_category"  databaseType="VARCHAR2" datatype="java.lang.String"  forDisplay="false"
                   physicalName="CLAUSE_CATEGORY" prompt="单据类别"/>
+        <bm:field name="show_seq" databaseType="VARCHAR2" datatype="java.lang.String"  forDisplay="false"
+                  physicalName="CLAUSE_CATEGORY" prompt="重要文件标识"/>
     </bm:fields>
     <bm:features>
         <f:standard-who/>
Index: src/main/resources/leaf_static/modules/hn/HN12001/hn_capital_plan_batch_not_approved.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/hn/HN12001/hn_capital_plan_batch_not_approved.lview b/src/main/resources/leaf_static/modules/hn/HN12001/hn_capital_plan_batch_not_approved.lview
new file mode 100644
--- /dev/null	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
+++ b/src/main/resources/leaf_static/modules/hn/HN12001/hn_capital_plan_batch_not_approved.lview	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
@@ -0,0 +1,148 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+    $Author: sys
+-->
+<a:screen xmlns:a="http://www.leaf-framework.org/application" customizationEnabled="true" trace="true">
+    <a:init-procedure>
+        <a:model-query defaultWhereClause="t1.org_user_id=${/session/user_id} and rownum =1" fetchAll="true"
+                       model="hn.HN12000.hn_capital_plan_submit" rootPath="org_user_list"/>
+    </a:init-procedure>
+    <a:view>
+        <a:link id="con_contract_get_layout_code_link_id" model="cont.CON500.con_contract_get_layout_code"
+                modelaction="update"/>
+        <a:link id="hn_capital_plan_detail_modify_link_id"
+                url="${/request/@context_path}/modules/hn/HN12000/hn_capital_plan_batch_detail.lview"/>
+        <script><![CDATA[
+
+        function hn_capital_plan_batch_query() {
+            $('hn_capital_plan_batch_ds').query();
+        }
+
+        function hn_capital_plan_batch_reset() {
+            $('hn_capital_plan_batch_query_ds').reset();
+            $('hn_capital_plan_batch_ds').query();
+        }
+
+
+        function hn_capital_plan_detail_win(ds_id, record_id) {
+            debugger;
+            var record = $(ds_id).findById(record_id);
+            if (record.get('batch_status') == 'RUNNING' && record.get('approved_status') == 'APPROVED') {
+                var param = record.data;
+                param['function_usage'] = 'QUERY';
+                param['maintain_type'] = 'QUERY';
+                param['function_code'] = 'HN12000W';
+                param['url_title'] = '资金计划填充明细';
+            } else if (record.get('batch_status') == 'RUNNING' && record.get('approved_status') != 'APPROVING') {
+                record.set('org_name', '${/model/org_user_list/record/@org_name}');
+                var param = record.data;
+                param['function_usage'] = 'MODIFY';
+                param['maintain_type'] = 'UPDATE';
+                param['function_code'] = 'HN12000D';
+                param['url_title'] = '资金计划填充明细';
+            } else {
+                var param = record.data;
+                param['function_usage'] = 'QUERY';
+                param['maintain_type'] = 'QUERY';
+                param['function_code'] = 'HN12000Q';
+                param['url_title'] = '资金计划填充明细';
+            }
+            hls_doc_get_layout_code('con_contract_get_layout_code_link_id', param, 'hn_capital_plan_detail_modify_link_id', ds_id);
+        }
+
+        function batch_number_renderer(value, record, name) {
+            if (name == 'batch_number') {
+                if (value) {
+                    return '<a href="javascript:hn_capital_plan_detail_win(\'' + record.ds.id + '\',\'' + record.id + '\')">' + value + '</a>';
+                } else {
+                    return '';
+                }
+            }
+        }
+
+        ]]></script>
+        <a:dataSets>
+            <a:dataSet id="batch_status_ds" lookupCode="HN_CAPITAL_BATCH_STATUS"/>
+            <a:dataSet id="approved_status_ds" lookupCode="HN_APPROVE_STATUS"/>
+            <a:dataSet id="hn_capital_plan_batch_query_ds">
+                <a:fields>
+                    <a:field name="batch_number"/>
+                    <a:field name="fill_date_from"/>
+                    <a:field name="fill_date_to"/>
+                    <a:field name="examine_date_from"/>
+                    <a:field name="examine_date_to"/>
+                    <a:field name="batch_status_n" displayField="code_value_name" options="batch_status_ds"
+                             returnField="batch_status" valueField="code_value"/>
+                    <a:field name="approved_status"/>
+                    <a:field name="approved_status_n" displayField="code_value_name" options="approved_status_ds"
+                             returnField="approved_status" valueField="code_value"/>
+                    <a:field name="batch_status"/>
+                </a:fields>
+            </a:dataSet>
+            <a:dataSet id="hn_capital_plan_batch_ds" fetchAll="true" autoQuery="true"
+                       autoPageSize="true" model="hn.HN12000.hn_capital_plan_wfl_update"
+                       queryUrl="${/request/@context_path}/autocrud/hn.HN12001.hn_capital_plan_wfl_update_not_approved/query?user_id=${/session/@user_id}"
+                       queryDataSet="hn_capital_plan_batch_query_ds" selectable="true">
+                <a:fields>
+                    <a:field name="batch_id"/>
+                    <a:field name="batch_number"/>
+                    <a:field name="create_by_desc"/>
+                    <a:field name="fill_date_from"/>
+                    <a:field name="fill_date_to"/>
+                    <a:field name="examine_date_from"/>
+                    <a:field name="examine_date_to"/>
+                    <a:field name="user_id"/>
+                    <a:field name="batch_status"/>
+                    <a:field name="batch_status_n"/>
+                    <a:field name="approved_status"/>
+                </a:fields>
+            </a:dataSet>
+        </a:dataSets>
+        <a:screenBody>
+            <a:screenTopToolbar>
+                <a:screenTitle/>
+                <a:gridButton click="hn_capital_plan_batch_query" text="HAP.QUERY"/>
+                <a:gridButton click="hn_capital_plan_batch_reset" text="重置"/>
+            </a:screenTopToolbar>
+            <a:form title="查询条件" style="width:100%">
+                <a:box column="4" labelWidth="150">
+                    <a:textField name="batch_number" bindTarget="hn_capital_plan_batch_query_ds" prompt="计划批次"
+                                 width="165"/>
+                    <a:datePicker name="fill_date_from" bindTarget="hn_capital_plan_batch_query_ds" prompt="填报日期从"
+                                  width="165"/>
+                    <a:datePicker name="fill_date_to" bindTarget="hn_capital_plan_batch_query_ds" prompt="填报日期到"
+                                  width="165"/>
+                    <a:datePicker name="examine_date_from" bindTarget="hn_capital_plan_batch_query_ds" prompt="考核日期从"
+                                  width="165"/>
+                </a:box>
+                <a:box column="4" labelWidth="150">
+                    <a:datePicker name="examine_date_to" bindTarget="hn_capital_plan_batch_query_ds" prompt="考核日期到"
+                                  width="165"/>
+                    <a:comboBox name="approved_status_n" bindTarget="hn_capital_plan_batch_query_ds" prompt="审批状态"
+                                width="165"/>
+                </a:box>
+            </a:form>
+            <a:grid id="hn_capital_plan_batch_ds_grid" bindTarget="hn_capital_plan_batch_ds" marginHeight="130"
+                    marginWidth="30"
+                    navBar="true">
+                <a:columns>
+                    <a:column name="batch_number" width="180" prompt="计划批次"
+                              align="center"/>
+                    <a:column name="create_by_desc" width="100" prompt="创建人" align="center"/>
+                    <a:column name="approved_status_n" width="180" prompt="审批状态" align="center"/>
+                    <a:column name="fill_date_from" width="180" prompt="填报日期从" align="center"
+                              renderer="Leaf.formatDate"/>
+                    <a:column name="fill_date_to" width="180" prompt="填报日期到" align="center" renderer="Leaf.formatDate"/>
+                    <a:column name="examine_date_from" width="180" prompt="考核日期从" align="center"
+                              renderer="Leaf.formatDate"/>
+                    <a:column name="examine_date_to" width="180" prompt="考核日期到" align="center"
+                              renderer="Leaf.formatDate"/>
+                    <a:column name="batch_status_n" width="180" prompt="批次状态" align="center"/>
+                    <a:column name="org_name" width="180" prompt="计划报送部门" align="center"/>
+
+                </a:columns>
+            </a:grid>
+        </a:screenBody>
+        <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.lview"/>
+    </a:view>
+</a:screen>
\ No newline at end of file
Index: src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_clause_lib_manage_lov.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_clause_lib_manage_lov.lview b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_clause_lib_manage_lov.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_clause_lib_manage_lov.lview	(revision d6dd03524c84402681f916566b577d8e2176b602)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_clause_lib_manage_lov.lview	(revision d13a9ba1ae1cd96785321a621f1f68fdff147a41)
@@ -67,6 +67,7 @@
                     <a:column name="antistop_key"  width="120" prompt="二级分类" />
                     <a:column name="third_classification"  width="120" prompt="三级分类" />
                     <a:column name="content_overview" width="240" prompt="内容概述"  renderer="details_red_renderer"/>
+                    <a:column name="show_seq" width="100" prompt="重要文件标识"/>
                 </a:columns>
             </a:table>
         </a:screenBody>
Index: src/main/resources/leaf_static/hn_cdd_item_upload.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/hn_cdd_item_upload.lview b/src/main/resources/leaf_static/hn_cdd_item_upload.lview
--- a/src/main/resources/leaf_static/hn_cdd_item_upload.lview	(revision 70063c5e0cfffe2e6f572b68fda4e15379e4e7c4)
+++ b/src/main/resources/leaf_static/hn_cdd_item_upload.lview	(revision b34fe53e3621e8ee43725d158fc39cbf2250f35d)
@@ -37,8 +37,7 @@
             <c:process-config>
                 <a:switch test="/parameter/@only_update_flag">
                     <a:case value="Y">
-                        <a:screen-include
-                                    screen="hn_cdd_item_uploadFile.lview?header_id=${/parameter/@header_id}&amp;table_name=${/parameter/@table_name}&amp;upload_type=ONLYUPDATE&amp;upload_version=${@value_code}&amp;value_name=${@value_name}"/>
+                        <a:screen-include screen="hn_cdd_item_uploadFile.lview?header_id=${/parameter/@header_id}&amp;table_name=${/parameter/@table_name}&amp;upload_type=ONLYUPDATE&amp;upload_version=${@value_code}&amp;value_name=${@value_name}"/>
                     </a:case>
                     <a:case value="*">
                         <a:screen-include
Index: src/main/resources/leaf_static/WEB-INF/classes/update_file_version_by_pk.lwm
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/WEB-INF/classes/update_file_version_by_pk.lwm b/src/main/resources/leaf_static/WEB-INF/classes/update_file_version_by_pk.lwm
new file mode 100644
--- /dev/null	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
+++ b/src/main/resources/leaf_static/WEB-INF/classes/update_file_version_by_pk.lwm	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
@@ -0,0 +1,16 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<bm:model xmlns:bm="http://www.leaf-framework.org/schema/bm">
+    <bm:operations>
+        <bm:operation name="execute">
+            <bm:update-sql><![CDATA[
+            begin
+                hls_bp_master_pkg.update_file_version_by_pk(p_table_name   => ${@table_name},
+                                                            p_table_pk_value => ${@table_pk_value});
+
+            end;
+
+            ]]></bm:update-sql>
+        </bm:operation>
+    </bm:operations>
+
+</bm:model>
Index: src/main/resources/leaf_static/modules/hls/HLS214N/hls_bp_master_modify.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/hls/HLS214N/hls_bp_master_modify.lview b/src/main/resources/leaf_static/modules/hls/HLS214N/hls_bp_master_modify.lview
--- a/src/main/resources/leaf_static/modules/hls/HLS214N/hls_bp_master_modify.lview	(revision 7d6a7f02a48bd87edfb58111cf4464b0183e432a)
+++ b/src/main/resources/leaf_static/modules/hls/HLS214N/hls_bp_master_modify.lview	(revision 9a5f03c1a74ae607b63dd0ec9913b18f48393bc6)
@@ -201,6 +201,14 @@
                     });
                     win.on('close', function() {
                         //i=1;
+                        Leaf.request({
+                            url: '${/request/@context_path}/autocrud/update_file_version_by_pk/execute',
+                            para: {
+                                table_name: 'PRJ_CDD_ITEM_CHECK',
+                                table_pk_value: record.get('check_id')
+                            },
+                            scope: this
+                        });
                         record.ds.query(dsCurrentPage);
                     });
                 } else {
@@ -438,6 +446,15 @@
             };
             //更新时调用
             window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_update'] = function(ds, record, name, value, old_value, bp_seq) {
+                if(name == 'bp_name'){
+                    if(value != old_value){
+                        record.set('post_itfc_status','NEW');
+                        record.set('post_itfc_vender_status','NEW');
+                    }
+                    if(value != old_value){
+                        record.set('post_fund_status','NEW'); //add 资金同步标志  2020-08-04
+                    }
+                }
                 debugger;
                 var role_ds = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hls_bp_master_role');
                 if (role_ds == ds.id){
@@ -894,18 +911,7 @@
                     return value;
                 }
             };
-            //更新时调用
-            window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_update'] = function(ds, record, name, value, old_value, bp_seq) {
-                if(name == 'bp_name'){
-            	    if(value != old_value){
-            	    	record.set('post_itfc_status','NEW');
-            	    	record.set('post_itfc_vender_status','NEW');
-            	    }
-                    if(value != old_value){
-                        record.set('post_fund_status','NEW'); //add 资金同步标志  2020-08-04
-                    }
-            	}
-            };
+
         ]]></script>
     </a:view>
 </a:screen>
Index: src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_plan_attachment.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_plan_attachment.lview b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_plan_attachment.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_plan_attachment.lview	(revision 7d6a7f02a48bd87edfb58111cf4464b0183e432a)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501Z/hn_prj_plan_attachment.lview	(revision 4ebdff0f2a399ae4cd66c97bda63fa672aacc96f)
@@ -60,6 +60,15 @@
                 });

                 win.on('close', function () {
+                    Leaf.request({
+                        url: '${/request/@context_path}/autocrud/update_file_version_by_pk/execute',
+                        para: {
+                            table_name: 'PRJ_CDD_ITEM_CHECK',
+                            table_pk_value: record.get('check_id')
+                        },
+                        scope: this
+                    });
+
                     record.ds.query(dsCurrentPage);
                 });
             } else {
@@ -142,6 +151,22 @@

         };

+        //更新时调用
+        window['${/parameter/@bp_seq}${/parameter/@layout_code}_on_layout_dynamic_update'] = function(ds, record, name, value, old_value, bp_seq) {
+            let cdd_ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'prj_cdd_item_doc_ref');
+            if (ds.id === cdd_ds_id) {
+                if(name === 'investigate_guide_flag'){
+                    if(value === 'N'){
+                        record.getField('reason_alternative').setRequired(true);
+                    }
+                    else if(value === 'Y'){
+                        record.getField('reason_alternative').setRequired(false);
+                    }
+                }
+            }
+        }
+
+
         ]]></script>
         <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.lview"/>
     </a:view>
Index: src/main/resources/leaf_static/onlyUploadFile.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/onlyUploadFile.lview b/src/main/resources/leaf_static/onlyUploadFile.lview
--- a/src/main/resources/leaf_static/onlyUploadFile.lview	(revision 7d6a7f02a48bd87edfb58111cf4464b0183e432a)
+++ b/src/main/resources/leaf_static/onlyUploadFile.lview	(revision 0cb064eca0c00b0971fd3bc3647b108f68e2c933)
@@ -8,6 +8,7 @@
 <a:screen xmlns:c="leaf.application.action" xmlns:a="http://www.leaf-framework.org/application" xmlns:p="uncertain.proc" trace="true">
     <a:init-procedure>
         <a:model-query model="sys.sys_enable_image_system_query" rootPath="enable_image_system_flag"/>
+        <a:model-query model="fnd.fnd_attachment_project_query" rootPath="attachment_project_flag"/>
         <p:switch test="/model/enable_image_system_flag/record/@enable_image_system">
             <p:case value="Y">
                 <a:model-query model="img.img_attachment_url" rootPath="att_url"/>
@@ -41,34 +42,41 @@

     	]]></script>
         <a:screenBody>
-            <a:switch test="/model/enable_image_system_flag/record/@enable_image_system">
-                <a:case value="N">
-                    <div style="width:800px">
-                        <a:switch test="/parameter/@useSubFolder">
-                            <a:case value="Y">
-                                <a:upload buttonWidth="75" fileType="*.*" pkvalue="${/parameter/@header_id}" showdelete="false" sourcetype="${/parameter/@table_name}" text="附件上传" uploadurl="${/request/@context_path}/atm_upload_unUseSubFolder.lsc"/>
-                            </a:case>
-                            <a:case value="*">
-                                <a:upload buttonWidth="75" fileType="*.*" pkvalue="${/parameter/@header_id}" showdelete="false" sourcetype="${/parameter/@table_name}" text="附件上传" uploadurl="${/request/@context_path}/atm_upload.lsc"/>
-                            </a:case>
-                        </a:switch>
-                        <br/>
-                    </div>
-                </a:case>
-                <a:case value="Y">
-                    <a:tabPanel height="380" width="580">
-                        <a:tabs>
-                            <a:tab prompt="附件上传">
-                                <iframe id="upload_att" frameborder="no" height="345" src="${/model/att_url/record/@img_attachment_url}?type=1&amp;barcode=${/model/doc_info/record/@document_number}&amp;seqid=${/model/upload/record/@upload_seqid}&amp;IMGTYPE=${/model/doc_info/record/@img_type}&amp;IMGNAME=${/model/doc_info/record/@img_name}&amp;CURRENTIMGTYPE=${/model/doc_info/record/@current_img_type}&amp;CURRENTIMGNAME=${/model/doc_info/record/@current_img_name}" style="broder:none;margin:0;padding:0;" width="570"/>
-                            </a:tab>
-                            <a:tab prompt="附件查看">
-                                <iframe id="download_att" frameborder="no" height="345" src="${/model/att_url/record/@img_attachment_url}?type=2&amp;barcode=${/model/doc_info/record/@document_number}&amp;seqid=${/model/download/record/@download_seqid}&amp;IMGTYPE=${/model/doc_info/record/@img_type}&amp;IMGNAME=${/model/doc_info/record/@img_name}&amp;CURRENTIMGTYPE=${/model/doc_info/record/@current_img_type}&amp;CURRENTIMGNAME=${/model/doc_info/record/@current_img_name}" style="broder:none;margin:0;padding:0;" width="570"/>
-                            </a:tab>
-                        </a:tabs>
-                        <a:events>
-                            <a:event name="select" handler="selectTabFun"/>
-                        </a:events>
-                    </a:tabPanel>
+            <a:switch test="/model/attachment_project_flag/record/@flag">
+                <a:case value="Y">
+                    <a:screen-include screen="hn_cdd_item_upload.lview?header_id=${/parameter/@header_id}&amp;table_name=${/parameter/@table_name}&amp;only_update_flag=${/parameter/@only_update_flag}"/>
+                </a:case>
+                <a:case value="*">
+                    <a:switch test="/model/enable_image_system_flag/record/@enable_image_system">
+                        <a:case value="N">
+                            <div style="width:800px">
+                                <a:switch test="/parameter/@useSubFolder">
+                                    <a:case value="Y">
+                                        <a:upload buttonWidth="75" fileType="*.*" pkvalue="${/parameter/@header_id}" showdelete="false" sourcetype="${/parameter/@table_name}" text="附件上传" uploadurl="${/request/@context_path}/atm_upload_unUseSubFolder.lsc"/>
+                                    </a:case>
+                                    <a:case value="*">
+                                        <a:upload buttonWidth="75" fileType="*.*" pkvalue="${/parameter/@header_id}" showdelete="false" sourcetype="${/parameter/@table_name}" text="附件上传" uploadurl="${/request/@context_path}/atm_upload.lsc"/>
+                                    </a:case>
+                                </a:switch>
+                                <br/>
+                            </div>
+                        </a:case>
+                        <a:case value="Y">
+                            <a:tabPanel height="380" width="580">
+                                <a:tabs>
+                                    <a:tab prompt="附件上传">
+                                        <iframe id="upload_att" frameborder="no" height="345" src="${/model/att_url/record/@img_attachment_url}?type=1&amp;barcode=${/model/doc_info/record/@document_number}&amp;seqid=${/model/upload/record/@upload_seqid}&amp;IMGTYPE=${/model/doc_info/record/@img_type}&amp;IMGNAME=${/model/doc_info/record/@img_name}&amp;CURRENTIMGTYPE=${/model/doc_info/record/@current_img_type}&amp;CURRENTIMGNAME=${/model/doc_info/record/@current_img_name}" style="broder:none;margin:0;padding:0;" width="570"/>
+                                    </a:tab>
+                                    <a:tab prompt="附件查看">
+                                        <iframe id="download_att" frameborder="no" height="345" src="${/model/att_url/record/@img_attachment_url}?type=2&amp;barcode=${/model/doc_info/record/@document_number}&amp;seqid=${/model/download/record/@download_seqid}&amp;IMGTYPE=${/model/doc_info/record/@img_type}&amp;IMGNAME=${/model/doc_info/record/@img_name}&amp;CURRENTIMGTYPE=${/model/doc_info/record/@current_img_type}&amp;CURRENTIMGNAME=${/model/doc_info/record/@current_img_name}" style="broder:none;margin:0;padding:0;" width="570"/>
+                                    </a:tab>
+                                </a:tabs>
+                                <a:events>
+                                    <a:event name="select" handler="selectTabFun"/>
+                                </a:events>
+                            </a:tabPanel>
+                        </a:case>
+                    </a:switch>
                 </a:case>
             </a:switch>
         </a:screenBody>
Index: src/main/resources/leaf_static/modules/hls/HLS213N/hls_bp_master_create.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/hls/HLS213N/hls_bp_master_create.lview b/src/main/resources/leaf_static/modules/hls/HLS213N/hls_bp_master_create.lview
--- a/src/main/resources/leaf_static/modules/hls/HLS213N/hls_bp_master_create.lview	(revision ded7d0b299132c58d2aac0bc9258d5bc67c9a3df)
+++ b/src/main/resources/leaf_static/modules/hls/HLS213N/hls_bp_master_create.lview	(revision 59b2c5b69b852aa96aa66baa99244b3901b2a1f2)
@@ -184,6 +184,18 @@
                         }
                     }

+                }
+
+                let cdd_ds = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'prj_cdd_item_doc_ref', 'T_CERTIFICATE');
+                if(cdd_ds === ds.id){
+                    if(name === 'investigate_guide_flag'){
+                        if(value === 'N'){
+                            record.getField('reason_alternative').setRequired(true);
+                        }
+                        else if(value === 'Y'){
+                            record.getField('reason_alternative').setRequired(false);
+                        }
+                    }
                 }
             };
             //保存前调用，生成商机编号
@@ -257,6 +269,14 @@
                         height: 400
                     });
                     win.on('close', function() {
+                        Leaf.request({
+                            url: '${/request/@context_path}/autocrud/update_file_version_by_pk/execute',
+                            para: {
+                                table_name: 'PRJ_CDD_ITEM_CHECK',
+                                table_pk_value: record.get('check_id')
+                            },
+                            scope: this
+                        });
                         record.ds.query(dsCurrentPage);
                     });
                 } else {
Index: src/main/resources/leaf_static/modules/prj/PRJ501Z/prj_project_modify_info.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501Z/prj_project_modify_info.lview b/src/main/resources/leaf_static/modules/prj/PRJ501Z/prj_project_modify_info.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501Z/prj_project_modify_info.lview	(revision 926c9264c5c3d0f8bcf031781a815e011015e202)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501Z/prj_project_modify_info.lview	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
@@ -100,6 +100,8 @@
             var ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'prj_project');
             var structure_deal_ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hn_project_structure_deal');
             var structure_factor_ds_id = get_dsid_by_basetable(window['${/parameter/@layout_code}_layoutDataSetList'], 'hn_prj_factor_structure');
+
+
             if (ds_id == ds.id) {
                 record.set('plan_times', '${/parameter/@plan_times}');
                 record.set('plan_times_n', '${/parameter/@plan_times_n}');
@@ -372,6 +374,7 @@
                 $(ds_id).getField('equipment_seller_n').setRequired(true);
             }*/
             window['${/parameter/@layout_code}_unlock_layout_dynamic_window']();
+            //

         };

Index: src/main/java/com/hand/hls/file/controllers/HnCopyFileController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/controllers/HnCopyFileController.java b/src/main/java/com/hand/hls/file/controllers/HnCopyFileController.java
--- a/src/main/java/com/hand/hls/file/controllers/HnCopyFileController.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/controllers/HnCopyFileController.java	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -42,6 +42,7 @@
                                                HttpServletRequest request) {
         ResponseData responseData = new ResponseData(true);
         String flag="Y";
+        System.out.println("in");
         try {
             HttpSession session = request.getSession(false);
             Long userId = (Long) session.getAttribute(IRequest.FIELD_USER_ID);
Index: src/main/java/com/hand/hls/file/dto/HnBpAttachmentRecordEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/dto/HnBpAttachmentRecordEntity.java b/src/main/java/com/hand/hls/file/dto/HnBpAttachmentRecordEntity.java
--- a/src/main/java/com/hand/hls/file/dto/HnBpAttachmentRecordEntity.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/dto/HnBpAttachmentRecordEntity.java	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -26,6 +26,13 @@
     private Long programId;
     private Long lastUpdateLogin;

+    private String cddCategory;
+    private String projectRequiredFlag;
+    private String lenderTabGroup;
+    private String showSeq;
+    private String investigateGuideFlag;
+    private String reasonAlternative;
+
     @Transient
     private String tableName;

@@ -207,6 +214,54 @@
         this.lastUpdateLogin = lastUpdateLogin;
     }

+    public String getCddCategory() {
+        return cddCategory;
+    }
+
+    public void setCddCategory(String cddCategory) {
+        this.cddCategory = cddCategory;
+    }
+
+    public String getProjectRequiredFlag() {
+        return projectRequiredFlag;
+    }
+
+    public void setProjectRequiredFlag(String projectRequiredFlag) {
+        this.projectRequiredFlag = projectRequiredFlag;
+    }
+
+    public String getLenderTabGroup() {
+        return lenderTabGroup;
+    }
+
+    public void setLenderTabGroup(String lenderTabGroup) {
+        this.lenderTabGroup = lenderTabGroup;
+    }
+
+    public String getShowSeq() {
+        return showSeq;
+    }
+
+    public void setShowSeq(String showSeq) {
+        this.showSeq = showSeq;
+    }
+
+    public String getInvestigateGuideFlag() {
+        return investigateGuideFlag;
+    }
+
+    public void setInvestigateGuideFlag(String investigateGuideFlag) {
+        this.investigateGuideFlag = investigateGuideFlag;
+    }
+
+    public String getReasonAlternative() {
+        return reasonAlternative;
+    }
+
+    public void setReasonAlternative(String reasonAlternative) {
+        this.reasonAlternative = reasonAlternative;
+    }
+
     @Override
     public boolean equals(Object o) {
         if (this == o) return true;
Index: src/main/java/com/hand/hls/file/dto/HnCddRefCheckEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/dto/HnCddRefCheckEntity.java b/src/main/java/com/hand/hls/file/dto/HnCddRefCheckEntity.java
--- a/src/main/java/com/hand/hls/file/dto/HnCddRefCheckEntity.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/dto/HnCddRefCheckEntity.java	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -15,6 +15,21 @@
     private String documentTable;
     private long cddItemId;

+    @Transient
+    private String cddCategory;
+    @Transient
+    private String projectRequiredFlag;
+    @Transient
+    private String lenderTabGroup;
+    @Transient
+    private String showSeq;
+    @Transient
+    private String investigateGuideFlag;
+    @Transient
+    private String reasonAlternative;
+
+
+
     @Transient
     private Long checkId;

@@ -103,6 +118,54 @@
         this.id = id;
     }

+    public String getCddCategory() {
+        return cddCategory;
+    }
+
+    public void setCddCategory(String cddCategory) {
+        this.cddCategory = cddCategory;
+    }
+
+    public String getProjectRequiredFlag() {
+        return projectRequiredFlag;
+    }
+
+    public void setProjectRequiredFlag(String projectRequiredFlag) {
+        this.projectRequiredFlag = projectRequiredFlag;
+    }
+
+    public String getLenderTabGroup() {
+        return lenderTabGroup;
+    }
+
+    public void setLenderTabGroup(String lenderTabGroup) {
+        this.lenderTabGroup = lenderTabGroup;
+    }
+
+    public String getShowSeq() {
+        return showSeq;
+    }
+
+    public void setShowSeq(String showSeq) {
+        this.showSeq = showSeq;
+    }
+
+    public String getInvestigateGuideFlag() {
+        return investigateGuideFlag;
+    }
+
+    public void setInvestigateGuideFlag(String investigateGuideFlag) {
+        this.investigateGuideFlag = investigateGuideFlag;
+    }
+
+    public String getReasonAlternative() {
+        return reasonAlternative;
+    }
+
+    public void setReasonAlternative(String reasonAlternative) {
+        this.reasonAlternative = reasonAlternative;
+    }
+
     @Override
     public boolean equals(Object o) {
         if (this == o) return true;
Index: src/main/java/com/hand/hls/file/dto/PrjCddItemEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/dto/PrjCddItemEntity.java b/src/main/java/com/hand/hls/file/dto/PrjCddItemEntity.java
--- a/src/main/java/com/hand/hls/file/dto/PrjCddItemEntity.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/dto/PrjCddItemEntity.java	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -73,6 +73,7 @@
     @Transient
     private String tabGroup;

+
     public String getTabGroup() {
         return tabGroup;
     }
Index: src/main/java/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.java b/src/main/java/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.java
--- a/src/main/java/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.java	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -12,4 +12,6 @@

     Long queryCopyFileRecordNextval();

+    void updateBpAttachmentByRecordId(HnBpAttachmentRecordEntity hnBpAttachmentRecordEntity);
+
 }
\ No newline at end of file
Index: src/main/java/com/hand/hls/file/service/impl/HnBpAttachSyncServiceImpl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/hand/hls/file/service/impl/HnBpAttachSyncServiceImpl.java b/src/main/java/com/hand/hls/file/service/impl/HnBpAttachSyncServiceImpl.java
--- a/src/main/java/com/hand/hls/file/service/impl/HnBpAttachSyncServiceImpl.java	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/java/com/hand/hls/file/service/impl/HnBpAttachSyncServiceImpl.java	(revision bf5bf1728a734d07019476c8f7b6b643607505bc)
@@ -78,6 +78,7 @@
     @Autowired
     private IHnBpAttachSyncService hnBpAttachSyncService;

+
     @Override
     public List<FndAtmAttachmentMultiEntity> queryAttachmentMultiByCheckId(HnBpAttachmentRecordEntity hnBpAttachmentRecordEntity) {
         return hnBpAttachSyncMapper.queryAttachmentMultiByCheckId(hnBpAttachmentRecordEntity);
@@ -203,7 +204,7 @@
                         deleteAtmRecord(hlsCusFndAtmAttachmentMulti, queryAttachmentRecord, deleteFileFlag);
                     }
                 } catch (IOException e) {
-                    logger.error(DELETE_FILE_ERROR);
+                    logger.error(DELETE_FILE_ERROR + "文件路径为" + queryAttachmentRecord.getFilePath());
                 }
             }
     }
@@ -212,13 +213,12 @@
     void deleteAtmRecord(FndAtmAttachmentMultiEntity hlsCusFndAtmAttachmentMulti,
                          FndAtmAttachmentEntity fndAtmAttachmentDto,String deleteFileFlag) throws IOException {
        if (deleteFileFlag == DELETE_FILE_FLAG_Y) {
-            boolean flag = iHnCopyFileRecordService.deleteFile(fndAtmAttachmentDto.getFilePath());
-            if (flag == true) {
-                this.fndAtmAttachmentMapper.deleteByPrimaryKey(fndAtmAttachmentDto);
-                this.fndAtmAttachmentMutiMapper.deleteByPrimaryKey(hlsCusFndAtmAttachmentMulti);
-            } else{
+           boolean flag = iHnCopyFileRecordService.deleteFile(fndAtmAttachmentDto.getFilePath());
+           this.fndAtmAttachmentMapper.deleteByPrimaryKey(fndAtmAttachmentDto);
+           this.fndAtmAttachmentMutiMapper.deleteByPrimaryKey(hlsCusFndAtmAttachmentMulti);
+           if(!flag) {
                 throw new IOException(DELETE_FILE_ERROR);
-            }
+           }
         } else {
             this.fndAtmAttachmentMapper.deleteByPrimaryKey(fndAtmAttachmentDto);
             this.fndAtmAttachmentMutiMapper.deleteByPrimaryKey(hlsCusFndAtmAttachmentMulti);
@@ -244,6 +244,7 @@
         Date date = new Date();
         //--拷贝商业伙伴附件 插入记录表 直接查询出对应的附件表 将对应的 table_name 和tablpe_pk_value 换掉
         for (HnCddRefCheckEntity item1 : bpList) {
+            System.out.println(item1.toString());
             Long checkId = item1.getCheckId();
             prjCddItemEntity.setCheckId(checkId);
             int bpCountNum = hnBpAttachSyncMapper.queryBpCountNum(prjCddItemEntity);
@@ -256,6 +257,8 @@
                 hnBpAttachmentRecordEntity.setCheckId(checkId);
                 prjCddItemEntity.setHnRecordId(hnRecordId);
                 fndAtmTableCopyService.fndAtmTableCopyNew(hnBpAttachmentRecordEntity,hnRecordId,userId);
+                //更新商业伙伴附件信息
+                updateBpAttachmentInfo(item1, hnRecordId);
             } else {
                 String v_note = "";
                 String cddItem = "";
@@ -287,12 +290,36 @@
                 hnBpAttachmentRecordEntity.setCheckId(checkId);
                 hnBpAttachmentRecordEntity.setBpId(bpId);
                 hnBpAttachmentRecordEntity.setCddItem(cddItem);
+                hnBpAttachmentRecordEntity.setCddCategory(item1.getCddCategory());
+                hnBpAttachmentRecordEntity.setInvestigateGuideFlag(item1.getInvestigateGuideFlag());
+                hnBpAttachmentRecordEntity.setShowSeq(item1.getShowSeq());
+                hnBpAttachmentRecordEntity.setReasonAlternative(item1.getReasonAlternative());
+                hnBpAttachmentRecordEntity.setLenderTabGroup(item1.getLenderTabGroup());
+                hnBpAttachmentRecordEntity.setProjectRequiredFlag(item1.getProjectRequiredFlag());
                 int i = hnBpAttachmentRecordrMapper.insertSelective(hnBpAttachmentRecordEntity);
                 fndAtmTableCopyService.fndAtmTableCopyNew(hnBpAttachmentRecordEntity, recordId, userId);
             }
         }
     }

+    /**
+     * 更新 项目方案中的项目 的 商业伙伴的附件信息
+     * @param bpAttachmentInfo 在商业伙伴附件信息表里查出来的数据
+     * @param hnRecordId 商业伙伴附件信息表主键ID
+     */
+    private void updateBpAttachmentInfo(HnCddRefCheckEntity bpAttachmentInfo, Long hnRecordId){
+        HnBpAttachmentRecordEntity updateAttachmentInfo = new HnBpAttachmentRecordEntity();
+        updateAttachmentInfo.setHnRecordId(hnRecordId);
+        updateAttachmentInfo.setCddCategory(bpAttachmentInfo.getCddCategory());
+        updateAttachmentInfo.setInvestigateGuideFlag(bpAttachmentInfo.getInvestigateGuideFlag());
+        updateAttachmentInfo.setShowSeq(bpAttachmentInfo.getShowSeq());
+        updateAttachmentInfo.setReasonAlternative(bpAttachmentInfo.getReasonAlternative());
+        updateAttachmentInfo.setLenderTabGroup(bpAttachmentInfo.getLenderTabGroup());
+        updateAttachmentInfo.setProjectRequiredFlag(bpAttachmentInfo.getProjectRequiredFlag());
+        hnBpAttachmentRecordrMapper.updateBpAttachmentByRecordId(updateAttachmentInfo);
+        logger.debug("hello");
+    }
+
     @Override
     public void delBpAttachment(PrjCddItemEntity prjCddItemEntity) {
             hnBpAttachSyncMapper.delAtmAttachment(prjCddItemEntity);
Index: src/main/resources/com/hand/hls/file/mapper/HnBpAttachSyncMapper.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/com/hand/hls/file/mapper/HnBpAttachSyncMapper.xml b/src/main/resources/com/hand/hls/file/mapper/HnBpAttachSyncMapper.xml
--- a/src/main/resources/com/hand/hls/file/mapper/HnBpAttachSyncMapper.xml	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/resources/com/hand/hls/file/mapper/HnBpAttachSyncMapper.xml	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -13,6 +13,12 @@
         <result column="CDD_ITEM_ID" property="cddItemId" jdbcType="DECIMAL" />
         <result column="CHECK_ID" property="checkId" jdbcType="DECIMAL" />
         <result column="TAB_GROUP" property="tabGroup" jdbcType="VARCHAR" />
+        <result column="CDD_CATEGORY" property="cddCategory" jdbcType="VARCHAR"/>
+        <result column="PROJECT_REQUIRED_FLAG" property="projectRequiredFlag" jdbcType="VARCHAR"/>
+        <result column="LENDER_TAB_GROUP" property="lenderTabGroup" jdbcType="VARCHAR"/>
+        <result column="SHOW_SEQ" property="showSeq" jdbcType="VARCHAR"/>
+        <result column="INVESTIGATE_GUIDE_FLAG" property="investigateGuideFlag" jdbcType="VARCHAR"/>
+        <result column="REASON_ALTERNATIVE" property="reasonAlternative" jdbcType="VARCHAR"/>
     </resultMap>
     <resultMap id="BaseResultMuiltMap" type="com.hand.hls.file.dto.FndAtmAttachmentMultiEntity">
         <result column="RECORD_ID" property="recordId" jdbcType="DECIMAL" />
@@ -61,39 +67,48 @@
             resultMap="BaseResultMap">

         SELECT pp.check_id,pci.cdd_item,pp.document_id,pp.document_table,
-               pp.cdd_item_id,pci.description,pci.order_seq,pci.note,tg.tab_group_id
-                    FROM (SELECT pcf.check_id,
-                                 pcf.document_id,
-                                 pcf.document_table,
-                                 pck.cdd_item_id
-                            FROM prj_cdd_item_doc_ref pcf,
-                                 prj_cdd_item_check   pck
-                           WHERE pcf.document_table = #{tableName,jdbcType=VARCHAR}
-                             AND pcf.document_id = #{bpId,jdbcType=DECIMAL} -- p_bp_id
-                             AND pck.check_id = pcf.check_id) pp,
-                         prj_cdd_item pci,
-                         prj_cdd_item_list_grp_tab lgt,
-                         prj_cdd_item_tab_group tg
-                   WHERE pci.cdd_item_id = lgt.cdd_item_id
-                     AND lgt.TAB_GROUP_ID = tg.TAB_GROUP_ID(+)
-                     AND nvl(lgt.enabled_flag, 'Y') = 'Y'
-                     AND nvl(tg.enabled_flag, 'Y') = 'Y'
-                     AND nvl(tg.tab_group_id, -1) = nvl(#{tabGroupId,jdbcType=DECIMAL}, -1)
-                     AND pci.cdd_item_id = pp.cdd_item_id(+)
-                     AND (nvl(pci.sys_flag, 'N') = 'Y' OR
-                         (nvl(pci.sys_flag, 'N') = 'N' AND
-                         pp.check_id IS NOT NULL))
-                     AND pci.cdd_list_id =
-                         nvl(#{cddListId,jdbcType=DECIMAL}, #{cddListId,jdbcType=DECIMAL})
-                     AND pci.enabled_flag = 'Y'
-                     AND lgt.cdd_list_id = #{cddListId,jdbcType=DECIMAL}
-                   ORDER BY lgt.seq_num ASC
+               pp.cdd_item_id,pci.description,pci.order_seq,pci.note,tg.tab_group_id,
+               (select cdd_category from prj_cdd_item_templet pct where pct.cdd_item = pci.cdd_item and pct.cdd_category is not null AND ROWNUM=1) cdd_category,
+               pci.project_required_flag,
+               pci.lender_tab_group,
+               pci.show_seq,
+               nvl(pp.investigate_guide_flag, 'Y') investigate_guide_flag,
+               pp.reason_alternative
+
+        FROM (SELECT pcf.check_id,
+                     pcf.document_id,
+                     pcf.document_table,
+                     pck.cdd_item_id,
+                     pck.investigate_guide_flag,
+                     pck.reason_alternative
+              FROM prj_cdd_item_doc_ref pcf,
+                   prj_cdd_item_check   pck
+              WHERE pcf.document_table = #{tableName,jdbcType=VARCHAR}
+                AND pcf.document_id = #{bpId,jdbcType=DECIMAL} -- p_bp_id
+                AND pck.check_id = pcf.check_id) pp,
+             prj_cdd_item pci,
+             prj_cdd_item_list_grp_tab lgt,
+             prj_cdd_item_tab_group tg
+        WHERE pci.cdd_item_id = lgt.cdd_item_id
+          AND lgt.TAB_GROUP_ID = tg.TAB_GROUP_ID(+)
+          AND nvl(lgt.enabled_flag, 'Y') = 'Y'
+          AND nvl(tg.enabled_flag, 'Y') = 'Y'
+          AND nvl(tg.tab_group_id, -1) = nvl(#{tabGroupId,jdbcType=DECIMAL}, -1)
+          AND pci.cdd_item_id = pp.cdd_item_id(+)
+          AND (nvl(pci.sys_flag, 'N') = 'Y' OR
+               (nvl(pci.sys_flag, 'N') = 'N' AND
+                pp.check_id IS NOT NULL))
+          AND pci.cdd_list_id =
+              nvl(#{cddListId,jdbcType=DECIMAL}, #{cddListId,jdbcType=DECIMAL})
+          AND pci.enabled_flag = 'Y'
+          AND lgt.cdd_list_id = #{cddListId,jdbcType=DECIMAL}
+        ORDER BY lgt.seq_num ASC
     </select>
-
+
     <select id="queryTabGroupId" parameterType="com.hand.hls.file.dto.PrjCddItemEntity"
             resultMap="BaseResultCddItem">
         SELECT tt.tab_group_id FROM prj_cdd_item_tab_group tt
-         WHERE tt.tab_group = #{tabGroup,jdbcType=VARCHAR}
+        WHERE tt.tab_group = #{tabGroup,jdbcType=VARCHAR}
     </select>

     <select id="queryBpCountNum" resultType="java.lang.Integer">
@@ -117,20 +132,20 @@
     -->
     <select id="queryBpVNum" resultType="java.lang.Integer">
         SELECT COUNT(1) as v_num
-            FROM prj_project_bp ppb
-             WHERE
-                1 = 1
-                <if test="prjBpId != null">
-                    AND ppb.prj_bp_id = #{prjBpId,jdbcType=DECIMAL}
-                </if>
-                AND EXISTS
-                    (SELECT 1 FROM prj_project pp
-                        WHERE
-                          1 = 1
-                            <if test="projectId != null">
-                                and pp.project_id = #{projectId,jdbcType=DECIMAL}
-                            </if>
-                          AND pp.data_class = 'NORMAL')
+        FROM prj_project_bp ppb
+        WHERE
+        1 = 1
+        <if test="prjBpId != null">
+            AND ppb.prj_bp_id = #{prjBpId,jdbcType=DECIMAL}
+        </if>
+        AND EXISTS
+        (SELECT 1 FROM prj_project pp
+        WHERE
+        1 = 1
+        <if test="projectId != null">
+            and pp.project_id = #{projectId,jdbcType=DECIMAL}
+        </if>
+        AND pp.data_class = 'NORMAL')

     </select>

@@ -138,17 +153,17 @@
             parameterType="com.hand.hls.file.dto.HnBpAttachmentRecordEntity"
             resultMap="BaseResultMuiltMap" >
         SELECT * FROM fnd_atm_attachment_multi tt
-                    WHERE
-                    1 = 1
-                        <if test="checkId != null">
-                            and tt.table_pk_value = #{checkId,jdbcType=DECIMAL}
-                        </if>
-                      AND tt.table_name = #{tableName,jdbcType=VARCHAR}
-                     and nvl(tt.del_flag,0)=0
+        WHERE
+        1 = 1
+        <if test="checkId != null">
+            and tt.table_pk_value = #{checkId,jdbcType=DECIMAL}
+        </if>
+        AND tt.table_name = #{tableName,jdbcType=VARCHAR}
+        and nvl(tt.del_flag,0)=0
     </select>

     <select id="queryNextval" resultType="java.lang.Long">
-              SELECT fnd_atm_attachment_multi_s.nextval  FROM dual
+        SELECT fnd_atm_attachment_multi_s.nextval  FROM dual
     </select>


@@ -156,8 +171,8 @@

     <select id="queryAttachmentList" parameterType="com.hand.hls.file.dto.FndAtmAttachmentMultiEntity"
             resultMap="BaseResultAttachmentMap">
-              SELECT * FROM fnd_atm_attachment tt
-                      WHERE tt.attachment_id =#{attachmentId,jdbcType=DECIMAL}
+        SELECT * FROM fnd_atm_attachment tt
+        WHERE tt.attachment_id =#{attachmentId,jdbcType=DECIMAL}
     </select>

     <!--
@@ -167,59 +182,59 @@
     -->

     <select id="querySysGuid" resultType="java.lang.String">  /*   varchar类型*/
-              SELECT sys_guid()  FROM dual
+    SELECT sys_guid()  FROM dual
     </select>


     <select id="queryBeginPath" resultType="java.lang.String">
-             SELECT dd.directory_path as v_begin_path
-             FROM dba_directories dd
-             WHERE dd.directory_name = 'HLS_BP_ATTACH_DIR'
+        SELECT dd.directory_path as v_begin_path
+        FROM dba_directories dd
+        WHERE dd.directory_name = 'HLS_BP_ATTACH_DIR'
     </select>

     <select id="queryAttachmentId" resultType="java.lang.Long">
-             SELECT fnd_atm_attachment_s.nextval as v_attachment_id FROM dual
+        SELECT fnd_atm_attachment_s.nextval as v_attachment_id FROM dual
     </select>

     <select id="queryHnRecordId" resultType="java.lang.Long">
         SELECT tt.hn_record_id FROM hn_bp_attachment_record tt
-         WHERE
-         tt.check_id = #{checkId,jdbcType=DECIMAL}
-           AND tt.document_id = #{prjBpId,jdbcType=DECIMAL}
+        WHERE
+            tt.check_id = #{checkId,jdbcType=DECIMAL}
+          AND tt.document_id = #{prjBpId,jdbcType=DECIMAL}
     </select>

     <select id="queryAttachmentCount" parameterType="com.hand.hls.file.dto.PrjCddItemEntity" resultType="java.lang.Long">
         SELECT count(*) FROM fnd_atm_attachment_multi tt
-                    WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
-                          and tt.table_name = #{tableName,jdbcType=VARCHAR}
-                          and nvl(tt.del_flag,0)=0
+        WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
+          and tt.table_name = #{tableName,jdbcType=VARCHAR}
+          and nvl(tt.del_flag,0)=0
     </select>

     <select id="queryAttachmentRecord" parameterType="com.hand.hls.file.dto.FndAtmAttachmentEntity"
             resultMap="BaseResultAttachmentMap">
         select * from fnd_atm_attachment t
-              left join fnd_atm_attachment_multi ft on t.attachment_id = ft.attachment_id
-              where t.source_type_code = #{sourceTypeCode,jdbcType=VARCHAR}
-               and ft.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
-               and nvl(ft.del_flag,0)=0
-               and nvl(t.del_flag,0)=0
+                          left join fnd_atm_attachment_multi ft on t.attachment_id = ft.attachment_id
+        where t.source_type_code = #{sourceTypeCode,jdbcType=VARCHAR}
+          and ft.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
+          and nvl(ft.del_flag,0)=0
+          and nvl(t.del_flag,0)=0
     </select>


     <select id="queryAttachmentByTableNameAndPkValue" parameterType="com.hand.hls.file.dto.FndAtmAttachmentMultiEntity"
             resultMap="BaseResultMuiltMap">
         SELECT * FROM fnd_atm_attachment_multi tt
-                    WHERE tt.table_pk_value = #{tablePkValue,jdbcType=DECIMAL}
-                          and tt.table_name = #{tableName,jdbcType=VARCHAR}
-                          and nvl(tt.del_flag,0)=0
+        WHERE tt.table_pk_value = #{tablePkValue,jdbcType=DECIMAL}
+          and tt.table_name = #{tableName,jdbcType=VARCHAR}
+          and nvl(tt.del_flag,0)=0
     </select>

     <select id="selectByCodeAndPkValue" parameterType="com.hand.hls.file.dto.FndAtmAttachmentMultiEntity"
             resultMap="BaseResultAttachmentMap">
         SELECT * FROM fnd_atm_attachment tt
-                    WHERE tt.source_pk_value = #{recordId,jdbcType=DECIMAL}
-                    and tt.source_type_code = #{sourceTypeCode,jdbcType=VARCHAR}
-                    and nvl(tt.del_flag,0)=0
+        WHERE tt.source_pk_value = #{recordId,jdbcType=DECIMAL}
+          and tt.source_type_code = #{sourceTypeCode,jdbcType=VARCHAR}
+          and nvl(tt.del_flag,0)=0
     </select>


@@ -241,18 +256,18 @@


     <delete id="delAtachmentMultiByPkvalue" parameterType="com.hand.hls.file.dto.PrjCddItemEntity">
-          update fnd_atm_attachment_multi tt set tt.del_flag=1
-          WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
+        update fnd_atm_attachment_multi tt set tt.del_flag=1
+        WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
           and tt.table_name = #{tableName,jdbcType=VARCHAR}
     </delete>

     <delete id="delAtachmentByPkvalue" parameterType="com.hand.hls.file.dto.PrjCddItemEntity">
-     update fnd_atm_attachment faa set faa.del_flag=1 where faa.attachment_id in(
-                 select faa.attachment_id from  fnd_atm_attachment faa
-                     left join fnd_atm_attachment_multi tt on faa.attachment_id = tt.attachment_id
-                        WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
-                        and tt.table_name = #{tableName,jdbcType=VARCHAR} )
-</delete>
+        update fnd_atm_attachment faa set faa.del_flag=1 where faa.attachment_id in(
+            select faa.attachment_id from  fnd_atm_attachment faa
+                                               left join fnd_atm_attachment_multi tt on faa.attachment_id = tt.attachment_id
+            WHERE tt.table_pk_value = #{hnRecordId,jdbcType=DECIMAL}
+              and tt.table_name = #{tableName,jdbcType=VARCHAR} )
+    </delete>



@@ -261,28 +276,28 @@

     <!--改变商业伙伴删除全部记录-->
     <delete id="delAtmAttachment" parameterType="com.hand.hls.file.dto.PrjCddItemEntity">
-     update fnd_atm_attachment faa set faa.del_flag=1
-         WHERE faa.attachment_id IN
-               (SELECT faam.attachment_id
-                  FROM fnd_atm_attachment_multi faam,
-                       hn_bp_attachment_record  h
-                 WHERE faam.table_pk_value = h.hn_record_id
-                   AND h.document_id = #{prjBpId,jdbcType=DECIMAL}
-                   AND faam.table_name = #{tableName,jdbcType=VARCHAR})
+        update fnd_atm_attachment faa set faa.del_flag=1
+        WHERE faa.attachment_id IN
+              (SELECT faam.attachment_id
+               FROM fnd_atm_attachment_multi faam,
+                    hn_bp_attachment_record  h
+               WHERE faam.table_pk_value = h.hn_record_id
+                 AND h.document_id = #{prjBpId,jdbcType=DECIMAL}
+                 AND faam.table_name = #{tableName,jdbcType=VARCHAR})
     </delete>

     <delete id="delAtmAttachmentMulti" parameterType="com.hand.hls.file.dto.PrjCddItemEntity">
-     update fnd_atm_attachment_multi tt set tt.del_flag=1
-         WHERE tt.table_name = #{tableName,jdbcType=VARCHAR}
-           AND tt.table_pk_value IN
-               (SELECT h.hn_record_id
-                  FROM hn_bp_attachment_record h
-                 WHERE h.document_id = #{prjBpId,jdbcType=DECIMAL})
+        update fnd_atm_attachment_multi tt set tt.del_flag=1
+        WHERE tt.table_name = #{tableName,jdbcType=VARCHAR}
+          AND tt.table_pk_value IN
+              (SELECT h.hn_record_id
+               FROM hn_bp_attachment_record h
+               WHERE h.document_id = #{prjBpId,jdbcType=DECIMAL})
     </delete>

     <delete id="delAtmAttachmentRecord" parameterType="com.hand.hls.file.dto.PrjCddItemEntity">
         DELETE FROM hn_bp_attachment_record tt
-         WHERE tt.document_id = #{prjBpId,jdbcType=DECIMAL}
+        WHERE tt.document_id = #{prjBpId,jdbcType=DECIMAL}
     </delete>


Index: src/main/resources/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.xml b/src/main/resources/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.xml
--- a/src/main/resources/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.xml	(revision 880092eeb7250b9a91d4e5401db4ab856ee8cc81)
+++ b/src/main/resources/com/hand/hls/file/mapper/HnBpAttachmentRecordrMapper.xml	(revision e93f1a17e556c178a67d78babdbfee018c7c583d)
@@ -19,4 +19,15 @@
              WHERE t.hn_record_id = #{hnRecordId,jdbcType=DECIMAL}
     </select>

+    <update id="updateBpAttachmentByRecordId" parameterType="com.hand.hls.file.dto.HnBpAttachmentRecordEntity">
+        update hn_bp_attachment_record
+            set  CDD_CATEGORY = #{cddCategory},
+                INVESTIGATE_GUIDE_FLAG = #{investigateGuideFlag},
+                SHOW_SEQ = #{showSeq},
+                REASON_ALTERNATIVE = #{reasonAlternative},
+                PROJECT_REQUIRED_FLAG = #{projectRequiredFlag},
+                LENDER_TAB_GROUP = #{lenderTabGroup}
+                WHERE hn_record_id = #{hnRecordId,jdbcType=DECIMAL}
+    </update>
+
 </mapper>
\ No newline at end of file
Index: src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_contract_file_archive_wfl.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_contract_file_archive_wfl.lview b/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_contract_file_archive_wfl.lview
--- a/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_contract_file_archive_wfl.lview	(revision df811229c53b4ef248a6e144d4ae817599a90aa2)
+++ b/src/main/resources/leaf_static/modules/acrch/ARCHIVE002/con_contract_file_archive_wfl.lview	(revision 613a9f09b95854cac4d11cb1f724f77b50282218)
@@ -178,7 +178,21 @@
             }else if (current_seq == '50'){
                 $('WFL_MANUAL_FILE_ARCHIVE_G_ARCHIVE_FILE_SAVE_layout_dynamic_button_id').hide();
             }
+
+            if(!(current_seq === '50') && ds.id === ds_id){
+                $(ds_id).getAll().forEach(rec =>{
+                    rec.getField('document_number').setReadOnly(true);
+                })
+                // $(ds_id).getField('document_number').setReadOnly(false);
+                // console.log($(ds_id))
+            }
+
+            console.log('${/parameter/@archive_batch_id}')
+
         }
+
+        //50 节点设置维护文号
+
         ]]></script>
         <a:screen-include screen="modules/cont/CON500/con_contract_get_layout_code.lview"/>
     </a:view>
Index: src/main/resources/leaf_static/modules/prj/PRJ501ZW/hn_prj_project_plan_wfl.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501ZW/hn_prj_project_plan_wfl.lview b/src/main/resources/leaf_static/modules/prj/PRJ501ZW/hn_prj_project_plan_wfl.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501ZW/hn_prj_project_plan_wfl.lview	(revision df811229c53b4ef248a6e144d4ae817599a90aa2)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501ZW/hn_prj_project_plan_wfl.lview	(revision 276cd5b17dbeef0ffb4df8ac136ee2e3a1bf7c8b)
@@ -354,7 +354,7 @@
                 param['function_usage'] = 'QUERY';
                 param['maintain_type'] = 'READONLY';
             }
-
+            console.log(function_code)
             param['function_code'] = function_code;
             param['plan_id'] = plan_id;
             param['cdd_list_id'] = cdd_list_id;
Index: src/main/resources/leaf_static/modules/prj/PRJ501ZQ/hn_prj_project_plan_add.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ501ZQ/hn_prj_project_plan_add.lview b/src/main/resources/leaf_static/modules/prj/PRJ501ZQ/hn_prj_project_plan_add.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ501ZQ/hn_prj_project_plan_add.lview	(revision 341707e8169ff20c2908589aeacd5068f1c520c3)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ501ZQ/hn_prj_project_plan_add.lview	(revision 613a9f09b95854cac4d11cb1f724f77b50282218)
@@ -173,7 +173,7 @@
                         document_category: 'PROJECT',
                         document_type: 'PRJ_PLAN',
                         hn_industry_classification: record.get('hn_industry_classification'),
-                        binary_classification: record.get('binary_classification'),                                second_classification: record.get('second_classification'), /*add by zc for 清单优化*/
+                        binary_classification: record.get('binary_classification'),
                         second_classification: record.get('second_classification'), /*add by zc for 清单优化*/
                         bp_id_tenant:record.get('bp_id_tenant'),
                         bp_id_buyer:record.get('bp_id_buyer'),
Index: src/main/resources/leaf_static/modules/prj/PRJ506/prj_project_print_detail.lview
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/leaf_static/modules/prj/PRJ506/prj_project_print_detail.lview b/src/main/resources/leaf_static/modules/prj/PRJ506/prj_project_print_detail.lview
--- a/src/main/resources/leaf_static/modules/prj/PRJ506/prj_project_print_detail.lview	(revision 0e0d9ba091bea530c2606a16257a6f650d9f0380)
+++ b/src/main/resources/leaf_static/modules/prj/PRJ506/prj_project_print_detail.lview	(revision fce87bbd0e7c858c0859330362dcba736c5a0ffb)
@@ -320,9 +320,9 @@
               var url = $('con543_con_batch_dl_link_id').getUrl() + '?project_id=' + '${/parameter/@project_id}';
               window.open(url, '_self');
           }
-        //adjust by jcp 删除
+        //edit by jcp 删除
         function con500_delete_print() {
-            debugger;
+
             // $('con_contract_update_print_detail_grid_2').remove();
             /*$('con_contract_update_print_detail_line_ds').query();*/
             var record = $('con_contract_update_print_detail_line_ds').getSelected();
@@ -331,7 +331,7 @@
                 Leaf.showMessage('${l:PROMPT}','请选择一条记录！');
                 return;
             }
-            debugger;
+
             var param = [];
             for (var i=0;i<record.length;i++) {
                 var project_id = record[i].get('project_id');
@@ -346,7 +346,7 @@
                     content_id: content_id /*'${/parameter/@content_id}'*/
                 },
                 success:function (res) {
-                    debugger;
+
                     // Leaf.showMessage('提示','删除成功!');
                     Leaf.request({
                         url:$('con_contract_order').getUrl(),/*'prj.PRJ506.con_contract_content/execute',*/
@@ -354,7 +354,7 @@
                             project_id: project_id /*'${/parameter/@content_id}'*/
                         },
                         success:function (res) {
-                            debugger;
+
                             // Leaf.showMessage('提示','排序成功!');
                             $('con_contract_update_print_detail_line_ds').query();
                             return;
@@ -455,7 +455,7 @@
         };
          //在线查看 add jcp
          function con_change_link(record_id) {
-             debugger;
+
              var ch_show_flag = '${/parameter/@ch_show_flag}';
              var current_record = $('con_contract_update_print_detail_line_ds').findById(record_id);
              var templet_id = current_record.get('templet_id');
@@ -479,7 +479,7 @@
          }

         function edit_office_attachment_renderer(value, record, name) {
-        debugger;
+
             var contract_approval_flag= '${/parameter/@contract_approval_flag}';
             var change_flag = record.get('change_flag');
             var templet_id = record.get('templet_id');
@@ -507,7 +507,7 @@
         }

          function check_office_attachment_renderer(value, record, name) {
-         debugger;
+
              var contract_approval_flag= '${/parameter/@contract_approval_flag}';
              var change_flag = record.get('change_flag');
              var templet_id = record.get('templet_id');
@@ -712,7 +712,7 @@
         </a:screenBody>
         <script><![CDATA[
         Leaf.onReady(function() {
-             debugger;
+
             if ('${/parameter/@ch_show_flag}' == 'X') {
                 $('create_print_id').show();
                 $('con_print_detail_print_id').show();
